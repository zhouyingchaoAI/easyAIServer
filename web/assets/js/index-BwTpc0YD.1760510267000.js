import{u as ue}from"./vue-router-dk84T4JA.1760510267000.js";import"./request-DFXUHQ80.1760510267000.js";import{f as g}from"./frameextractor-CsrQaRFh.1760510267000.js";import{_ as re}from"./_plugin-vue_export-helper-DlAUqK2U.1760510267000.js";import{m as de,F as pe,V as _e,X as me,v as ce,S as fe,h as ve,g as ye,f as ke,I as ge,z as be,a2 as xe,c as we,w as he,B as Oe,a1 as Ce,T as ze,$ as Te,t as Ie,K as Se,k as _}from"./ant-design-vue-7NGz394s.1760510267000.js";import{y as S,aa as Ue,x as Pe,ab as N,ac as Be,I as Me,ad as Ae,ae as De,X as Ve,af as Fe,ag as Le,ah as Ee,P as $e,a4 as R,ai as Ke,a3 as Ne,aj as q,A as Re,ak as qe}from"./@ant-design-CBVXR3qv.1760510267000.js";import{r as x,j as Xe,Z as V,c as e,X as t,W as f,V as v,a1 as U,J as d,u as n,F as je,$ as h,a3 as b}from"./vue-DcFgi5qX.1760510267000.js";import"./axios-ngrFHoWO.1760510267000.js";import"./qs-CbQ4D0gn.1760510267000.js";import"./clipboard-DnI0MzOy.1760510267000.js";import"./side-channel-DfYK5TDq.1760510267000.js";import"./crypto-js-BuK4cu1G.1760510267000.js";import"./index-DKXoXMLo.1760510267000.js";import"./vue-i18n-BrqhYuiy.1760510267000.js";import"./@intlify-C7-MzqOv.1760510267000.js";import"./nprogress-Bk5182L2.1760510267000.js";/* empty css                                  */import"./dayjs-C6tMyYay.1760510267000.js";import"./pinia-CMnOSTvM.1760510267000.js";import"./pinia-plugin-persistedstate-n2tMOXAx.1760510267000.js";import"./lodash-es-C9rdhAyu.1760510267000.js";import"./@iconify-BZBGuI_d.1760510267000.js";import"./@babel-Bq4_u9L9.1760510267000.js";import"./@ctrl-DOFZgDuz.1760510267000.js";import"./resize-observer-polyfill-B1PUzC5B.1760510267000.js";import"./dom-align-CRCehRfe.1760510267000.js";import"./async-validator-9PlIezaS.1760510267000.js";import"./scroll-into-view-if-needed-B3z4cY-J.1760510267000.js";import"./throttle-debounce-CUWDS_la.1760510267000.js";import"./vue-types-CF28atMM.1760510267000.js";import"./@emotion-BtrR-yrm.1760510267000.js";import"./stylis-D5iaQeiq.1760510267000.js";const Ge={class:"p-4 frame-extractor-container"},He={class:"card-title"},Je={class:"card-title"},We={class:"rtsp-url"},Ze={style:{width:"200px"}},Qe={key:4},Ye={style:{"max-width":"250px"}},et={__name:"index",setup(tt){const F=ue(),l=x({enable:!0,interval_ms:1e3,output_dir:"./snapshots",store:"local",minio:{endpoint:"",bucket:"",access_key:"",secret_key:"",use_ssl:!1,base_path:""}}),m=x({id:"",rtsp_url:"",interval_ms:1e3,output_path:""}),P=x(!1),B=x(!1),M=x([]),O=x({}),T=x({}),X=[{title:"任务ID",key:"id",width:120},{title:"状态",key:"status",width:100},{title:"RTSP地址",key:"rtsp_url",ellipsis:!0},{title:"间隔",key:"interval_ms",width:150},{title:"输出路径",key:"output_path",width:150},{title:"操作",key:"action",width:280,fixed:"right"}],j=async()=>{try{const{data:s}=await g.getConfig();s&&(l.value={...l.value,...s},l.value.minio||(l.value.minio={endpoint:"",bucket:"",access_key:"",secret_key:"",use_ssl:!1,base_path:""}))}catch(s){console.error("fetch config failed",s)}},G=async()=>{var s,a;if(l.value.store==="minio"&&(!l.value.minio.endpoint||!l.value.minio.bucket)){_.error("请填写MinIO Endpoint和Bucket");return}B.value=!0;try{await g.updateConfig(l.value),_.success("配置保存成功")}catch(i){_.error(((a=(s=i==null?void 0:i.response)==null?void 0:s.data)==null?void 0:a.error)||"配置保存失败")}finally{B.value=!1}},w=async()=>{const{data:s}=await g.listTasks();M.value=(s==null?void 0:s.items)||[]},H=async()=>{var s,a;if(!m.value.id||!m.value.rtsp_url){_.error("请填写任务ID与RTSP地址");return}P.value=!0;try{await g.addTask(m.value),_.success("任务添加成功"+(l.value.store==="minio"?"，MinIO路径已创建":"")),m.value={id:"",rtsp_url:"",interval_ms:1e3,output_path:""},await w()}catch(i){_.error(((a=(s=i==null?void 0:i.response)==null?void 0:s.data)==null?void 0:a.error)||"添加失败")}finally{P.value=!1}},J=s=>{m.value={...s},window.scrollTo({top:0,behavior:"smooth"})},W=async s=>{var a,i;try{await g.delTask(s),_.success("任务删除成功"+(l.value.store==="minio"?"，MinIO路径已清理":"")),await w()}catch(p){_.error(((i=(a=p==null?void 0:p.response)==null?void 0:a.data)==null?void 0:i.error)||"删除失败")}},Z=()=>{F.push("/frame-extractor/gallery")},Q=s=>{F.push({path:"/frame-extractor/gallery",query:{task:s}})},Y=async s=>{var a,i;O.value[s]=!0;try{await g.startTask(s),_.success("任务已启动"),await w()}catch(p){_.error(((i=(a=p==null?void 0:p.response)==null?void 0:a.data)==null?void 0:i.error)||"启动失败")}finally{O.value[s]=!1}},ee=async s=>{var a,i;O.value[s]=!0;try{await g.stopTask(s),_.success("任务已停止"),await w()}catch(p){_.error(((i=(a=p==null?void 0:p.response)==null?void 0:a.data)==null?void 0:i.error)||"停止失败")}finally{O.value[s]=!1}},te=async s=>{var i,p;const a=T.value[s.id]||s.interval_ms;if(a<200){_.error("间隔不能小于200ms");return}try{await g.updateInterval(s.id,a),_.success("间隔已更新"+(s.enabled?"，任务已重启":"")),await w(),delete T.value[s.id]}catch(r){_.error(((p=(i=r==null?void 0:r.response)==null?void 0:i.data)==null?void 0:p.error)||"更新失败")}};return Xe(()=>{j(),w()}),(s,a)=>{const i=ve,p=fe,r=ce,c=me,A=ye,L=ke,C=_e,y=ge,ae=be,E=xe,z=we,le=he,k=Oe,$=pe,D=de,I=ze,K=Ie,oe=Te,se=Se,ne=Ce;return f(),V("div",Ge,[e(D,{bordered:!1,class:"config-card mb-4"},{title:t(()=>[h("span",He,[e(n(N),{class:"title-icon"}),a[14]||(a[14]=d(" 存储配置 ",-1))])]),default:t(()=>[e($,{model:l.value,layout:"vertical"},{default:t(()=>[e(C,{gutter:24},{default:t(()=>[e(c,{xs:24,sm:12,md:8},{default:t(()=>[e(r,{label:"存储类型"},{default:t(()=>[e(p,{value:l.value.store,"onUpdate:value":a[0]||(a[0]=o=>l.value.store=o),size:"large"},{default:t(()=>[e(i,{value:"local"},{default:t(()=>[e(n(S)),a[15]||(a[15]=d(" 本地文件系统 ",-1))]),_:1}),e(i,{value:"minio"},{default:t(()=>[e(n(Ue)),a[16]||(a[16]=d(" MinIO对象存储 ",-1))]),_:1})]),_:1},8,["value"])]),_:1})]),_:1}),e(c,{xs:24,sm:12,md:8},{default:t(()=>[e(r,{label:"默认抽帧间隔"},{default:t(()=>[e(A,{value:l.value.interval_ms,"onUpdate:value":a[1]||(a[1]=o=>l.value.interval_ms=o),min:200,step:100,size:"large",style:{width:"100%"}},{addonAfter:t(()=>[...a[17]||(a[17]=[d("毫秒",-1)])]),_:1},8,["value"])]),_:1})]),_:1}),e(c,{xs:24,sm:12,md:8},{default:t(()=>[e(r,{label:"启用状态"},{default:t(()=>[e(L,{checked:l.value.enable,"onUpdate:checked":a[2]||(a[2]=o=>l.value.enable=o),size:"large","checked-children":"已启用","un-checked-children":"已禁用"},null,8,["checked"])]),_:1})]),_:1})]),_:1}),l.value.store==="local"?(f(),v(r,{key:0,label:"本地输出目录"},{default:t(()=>[e(y,{value:l.value.output_dir,"onUpdate:value":a[3]||(a[3]=o=>l.value.output_dir=o),size:"large",placeholder:"./snapshots"},{prefix:t(()=>[e(n(Pe))]),_:1},8,["value"])]),_:1})):U("",!0),l.value.store==="minio"?(f(),V(je,{key:1},[e(ae,{orientation:"left"},{default:t(()=>[e(n(N)),a[18]||(a[18]=d(" MinIO 配置 ",-1))]),_:1}),e(E,{message:"提示",description:"Bucket不存在时会自动创建，任务ID会作为子路径，删除任务时会同步删除MinIO对应路径下的所有文件",type:"info","show-icon":"",class:"mb-4"}),e(C,{gutter:24},{default:t(()=>[e(c,{xs:24,sm:12},{default:t(()=>[e(r,{label:"Endpoint"},{default:t(()=>[e(y,{value:l.value.minio.endpoint,"onUpdate:value":a[4]||(a[4]=o=>l.value.minio.endpoint=o),size:"large",placeholder:"minio.example.com:9000"},{prefix:t(()=>[e(n(Be))]),_:1},8,["value"])]),_:1})]),_:1}),e(c,{xs:24,sm:12},{default:t(()=>[e(r,{label:"Bucket"},{default:t(()=>[e(y,{value:l.value.minio.bucket,"onUpdate:value":a[5]||(a[5]=o=>l.value.minio.bucket=o),size:"large",placeholder:"snapshots"},{prefix:t(()=>[e(n(Ae))]),suffix:t(()=>[e(z,{title:"不存在时会自动创建"},{default:t(()=>[e(n(Me),{style:{color:"rgba(0,0,0,.45)"}})]),_:1})]),_:1},8,["value"])]),_:1})]),_:1})]),_:1}),e(C,{gutter:24},{default:t(()=>[e(c,{xs:24,sm:12},{default:t(()=>[e(r,{label:"Access Key"},{default:t(()=>[e(y,{value:l.value.minio.access_key,"onUpdate:value":a[6]||(a[6]=o=>l.value.minio.access_key=o),size:"large",placeholder:"access key"},{prefix:t(()=>[e(n(De))]),_:1},8,["value"])]),_:1})]),_:1}),e(c,{xs:24,sm:12},{default:t(()=>[e(r,{label:"Secret Key"},{default:t(()=>[e(le,{value:l.value.minio.secret_key,"onUpdate:value":a[7]||(a[7]=o=>l.value.minio.secret_key=o),size:"large",placeholder:"secret key"},{prefix:t(()=>[e(n(Ve))]),_:1},8,["value"])]),_:1})]),_:1})]),_:1}),e(C,{gutter:24},{default:t(()=>[e(c,{xs:24,sm:12},{default:t(()=>[e(r,{label:"Base Path (可选)"},{default:t(()=>[e(y,{value:l.value.minio.base_path,"onUpdate:value":a[8]||(a[8]=o=>l.value.minio.base_path=o),size:"large",placeholder:"camera-frames"},{prefix:t(()=>[e(n(S))]),_:1},8,["value"])]),_:1})]),_:1}),e(c,{xs:24,sm:12},{default:t(()=>[e(r,{label:"使用 SSL"},{default:t(()=>[e(L,{checked:l.value.minio.use_ssl,"onUpdate:checked":a[9]||(a[9]=o=>l.value.minio.use_ssl=o),size:"large","checked-children":"HTTPS","un-checked-children":"HTTP"},null,8,["checked"])]),_:1})]),_:1})]),_:1})],64)):U("",!0),e(r,null,{default:t(()=>[e(k,{type:"primary",size:"large",onClick:G,loading:B.value},{icon:t(()=>[e(n(Fe))]),default:t(()=>[a[19]||(a[19]=d(" 保存配置 ",-1))]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),_:1}),e(D,{bordered:!1,class:"task-card"},{title:t(()=>[h("span",Je,[e(n(qe),{class:"title-icon"}),d(" 抽帧任务 ("+b(M.value.length)+") ",1)])]),extra:t(()=>[e(K,null,{default:t(()=>[e(I,{color:l.value.store==="minio"?"blue":"green"},{default:t(()=>[d(b(l.value.store==="minio"?"MinIO存储":"本地存储"),1)]),_:1},8,["color"]),e(k,{type:"primary",onClick:Z},{icon:t(()=>[e(n(q))]),default:t(()=>[a[20]||(a[20]=d(" 查看抽帧结果 ",-1))]),_:1})]),_:1})]),default:t(()=>[e(D,{class:"add-task-card mb-4",bordered:!1},{default:t(()=>[e($,{model:m.value,layout:"vertical"},{default:t(()=>[e(C,{gutter:16},{default:t(()=>[e(c,{xs:24,sm:12,md:6},{default:t(()=>[e(r,{label:"任务ID",required:!0},{default:t(()=>[e(y,{value:m.value.id,"onUpdate:value":a[10]||(a[10]=o=>m.value.id=o),size:"large",placeholder:"如 cam1"},{prefix:t(()=>[e(n(Le))]),_:1},8,["value"])]),_:1})]),_:1}),e(c,{xs:24,sm:12,md:10},{default:t(()=>[e(r,{label:"RTSP地址",required:!0},{default:t(()=>[e(y,{value:m.value.rtsp_url,"onUpdate:value":a[11]||(a[11]=o=>m.value.rtsp_url=o),size:"large",placeholder:"rtsp://user:pass@ip:554/..."},{prefix:t(()=>[e(n(Ee))]),_:1},8,["value"])]),_:1})]),_:1}),e(c,{xs:24,sm:12,md:4},{default:t(()=>[e(r,{label:"间隔(ms)"},{default:t(()=>[e(A,{value:m.value.interval_ms,"onUpdate:value":a[12]||(a[12]=o=>m.value.interval_ms=o),min:200,step:100,size:"large",style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1}),e(c,{xs:24,sm:12,md:4},{default:t(()=>[e(r,{label:"输出路径"},{default:t(()=>[e(y,{value:m.value.output_path,"onUpdate:value":a[13]||(a[13]=o=>m.value.output_path=o),size:"large",placeholder:"cam1"},{prefix:t(()=>[e(n(S))]),_:1},8,["value"])]),_:1})]),_:1})]),_:1}),e(r,null,{default:t(()=>[e(k,{type:"primary",size:"large",onClick:H,loading:P.value},{icon:t(()=>[e(n($e))]),default:t(()=>[a[21]||(a[21]=d(" 添加任务 ",-1))]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),_:1}),e(ne,{"data-source":M.value,columns:X,"row-key":"id",pagination:{pageSize:10,showTotal:o=>`共 ${o} 条`},scroll:{x:1200}},{bodyCell:t(({column:o,record:u})=>[o.key==="id"?(f(),v(I,{key:0,color:"blue"},{default:t(()=>[d(b(u.id),1)]),_:2},1024)):o.key==="status"?(f(),v(I,{key:1,color:u.enabled?"green":"default"},{default:t(()=>[d(b(u.enabled?"运行中":"已停止"),1)]),_:2},1032,["color"])):o.key==="rtsp_url"?(f(),v(z,{key:2,title:u.rtsp_url},{default:t(()=>[h("span",We,b(u.rtsp_url),1)]),_:2},1032,["title"])):o.key==="interval_ms"?(f(),v(oe,{key:3,trigger:"click",placement:"bottom"},{content:t(()=>[h("div",Ze,[e(A,{value:T.value[u.id],"onUpdate:value":ie=>T.value[u.id]=ie,min:200,step:100,style:{width:"100%","margin-bottom":"8px"},placeholder:"新间隔(ms)"},null,8,["value","onUpdate:value"]),e(k,{type:"primary",size:"small",block:"",onClick:()=>te(u)},{default:t(()=>[...a[22]||(a[22]=[d(" 确认修改 ",-1)])]),_:1},8,["onClick"])])]),default:t(()=>[e(I,{color:"green",style:{cursor:"pointer"}},{default:t(()=>[d(b(u.interval_ms)+"ms ",1),e(n(R),{style:{"font-size":"10px"}})]),_:2},1024)]),_:2},1024)):o.key==="output_path"?(f(),V("span",Qe,[e(n(S)),d(" "+b(u.output_path),1)])):o.key==="action"?(f(),v(K,{key:5},{default:t(()=>[e(z,{title:u.enabled?"停止抽帧":"启动抽帧"},{default:t(()=>[e(k,{type:u.enabled?"default":"primary",size:"small",onClick:()=>u.enabled?ee(u.id):Y(u.id),loading:O.value[u.id]},{icon:t(()=>[u.enabled?(f(),v(n(Ke),{key:0})):(f(),v(n(Ne),{key:1}))]),_:2},1032,["type","onClick","loading"])]),_:2},1032,["title"]),e(z,{title:"查看快照"},{default:t(()=>[e(k,{type:"default",size:"small",onClick:()=>Q(u.id)},{icon:t(()=>[e(n(q))]),_:1},8,["onClick"])]),_:2},1024),e(z,{title:"编辑"},{default:t(()=>[e(k,{type:"primary",size:"small",onClick:()=>J(u)},{icon:t(()=>[e(n(R))]),_:1},8,["onClick"])]),_:2},1024),e(se,{title:"确认删除?","ok-text":"删除","cancel-text":"取消",onConfirm:()=>W(u.id)},{description:t(()=>[h("div",Ye,[l.value.store==="minio"?(f(),v(E,{key:0,message:"将同时删除MinIO中的所有文件",type:"warning","show-icon":"",banner:!0,style:{"margin-bottom":"8px"}})):U("",!0),a[23]||(a[23]=d(" 此操作不可恢复，确认删除任务 ",-1)),h("strong",null,b(u.id),1),a[24]||(a[24]=d(" 吗？ ",-1))])]),default:t(()=>[e(k,{danger:"",size:"small"},{icon:t(()=>[e(n(Re))]),_:1})]),_:2},1032,["onConfirm"])]),_:2},1024)):U("",!0)]),_:1},8,["data-source","pagination"])]),_:1})])}}},At=re(et,[["__scopeId","data-v-bc2fc5c1"]]);export{At as default};
