# 快速更新指南 - 任务ID下拉选择

## 📝 本次更新

将告警列表的"任务ID"筛选从**手动输入**改为**自动下拉选择**。

## ✨ 效果对比

### 更新前 ❌
```
┌────────────────────────┐
│ 任务ID: [_________] 🔍│  ← 需要手动输入，容易出错
└────────────────────────┘
```

### 更新后 ✅
```
┌────────────────────────┐
│ 任务ID: [task_1 ▼]    │  ← 下拉选择，还能搜索
├────────────────────────┤
│ 全部任务               │
│ 11111                  │
│ task_1                 │
│ task_2                 │
│ 人数统计1              │
└────────────────────────┘
```

## 🎯 主要功能

1. **自动加载**：页面打开时自动获取所有任务ID
2. **下拉选择**：点击即可选择，无需记忆任务ID
3. **支持搜索**：输入关键词快速过滤（如输入"人数"查找包含人数的任务）
4. **防止错误**：避免拼写错误导致查询不到数据
5. **一键清空**：点击×清空选择，查看所有任务

## 🚀 使用方法

### 1. 直接选择
```
打开告警列表 → 点击"任务ID"下拉框 → 选择任务 → 自动查询
```

### 2. 搜索选择
```
点击下拉框 → 输入关键词(如"task") → 选择匹配项 → 自动查询
```

### 3. 查看所有
```
点击下拉框 → 选择"全部任务" → 显示所有告警
```

## 📦 修改的文件

### 后端 (Go)
```
internal/web/api/ai_analysis.go    ← 新增获取任务ID的API
internal/data/alert.go             ← 新增数据库查询函数
```

### 前端 (Vue)
```
web-src/src/api/alert.js           ← 新增API调用方法
web-src/src/views/alerts/index.vue ← 改为下拉选择框
```

## ✅ 验证步骤

1. **编译前端**（如果修改了前端代码）：
   ```bash
   cd web-src
   npm run build
   cd ..
   ```

2. **重新编译后端**：
   ```bash
   make build/linux
   ```

3. **启动服务**：
   ```bash
   cd build/EasyDarwin-lin-*
   ./easydarwin
   ```

4. **测试功能**：
   - 打开 http://localhost:5066/#/alerts
   - 检查"任务ID"是否显示为下拉选择框
   - 点击下拉框查看任务列表
   - 测试搜索功能

## 🔧 无需数据库迁移

✅ 本次更新**不需要修改数据库结构**  
✅ 直接编译运行即可使用

## 📊 API 说明

### 新增接口

**请求：**
```bash
GET /api/v1/alerts/task_ids
```

**响应：**
```json
{
  "task_ids": ["11111", "task_1", "task_2", "人数统计1"]
}
```

## 💡 使用技巧

### 1. 快速搜索
输入任务ID的**任意部分**都能匹配：
- 输入 `1` → 匹配 `11111`, `task_1`, `人数统计1`
- 输入 `task` → 匹配 `task_1`, `task_2`
- 输入 `人数` → 匹配 `人数统计1`

### 2. 键盘操作
- `↓` `↑` 键：在列表中导航
- `Enter` 键：选择当前项
- `Esc` 键：关闭下拉列表

### 3. 配合其他筛选
```
任务类型: 人数统计
任务ID: task_1
最少检测数: 5
→ 查询 task_1 任务中检测到5人以上的所有告警
```

## 🎨 界面截图说明

### 下拉列表
- 自动按字母顺序排序
- 最多显示10项，超过可滚动
- 选中项高亮显示

### 搜索状态
- 实时过滤，无延迟
- 不区分大小写
- 支持中英文搜索

## 📖 相关文档

- [详细功能说明](doc/FEATURE_TASK_ID_DROPDOWN.md)
- [检测个数功能](doc/FEATURE_UPDATE_DETECTION_COUNT.md)
- [完整更新日志](CHANGELOG_DETECTION_COUNT.md)

## 🐛 问题排查

### 下拉列表为空？
```bash
# 检查是否有告警数据
curl http://localhost:5066/api/v1/alerts/task_ids

# 应该返回：
{"task_ids":["task_1","task_2",...]}
```

### 搜索不工作？
- 确保使用的是最新编译的前端代码
- 检查浏览器控制台是否有错误
- 尝试清除浏览器缓存

## 📞 需要帮助？

查看完整文档：
- [FEATURE_TASK_ID_DROPDOWN.md](doc/FEATURE_TASK_ID_DROPDOWN.md)
- [README_CN.md](README_CN.md)

---

**版本**：v1.1.1  
**更新日期**：2024-10-17  
**更新内容**：任务ID自动下拉选择

