import{r as f,j,Z as M,c as e,X as a,W as g,V as O,a1 as I,J as m,F as q,u as z,G}from"./vue-DKWWAjK3.1760491696000.js";import{r as v}from"./request-CKqCOkPp.1760491696000.js";import{_ as J}from"./_plugin-vue_export-helper-DlAUqK2U.1760491696000.js";import{m as W,F as Z,V as $,X as H,v as Q,S as Y,h as ee,g as te,I as ae,z as le,c as oe,w as ne,f as ue,B as se,a1 as ie,K as re,k as _}from"./ant-design-vue-iXS37F4L.1760491696000.js";import{h as pe}from"./@ant-design-Cdq6XMRN.1760491696000.js";import"./axios-ngrFHoWO.1760491696000.js";import"./qs-Cpr2hUO8.1760491696000.js";import"./clipboard-DnI0MzOy.1760491696000.js";import"./side-channel-CriCoedh.1760491696000.js";import"./crypto-js-Bqbg-GGQ.1760491696000.js";import"./index-DVawRnRA.1760491696000.js";import"./vue-i18n-J8V2KeJ8.1760491696000.js";import"./@intlify-C7-MzqOv.1760491696000.js";import"./nprogress-CM8G2V50.1760491696000.js";/* empty css                                  */import"./dayjs-BayhGjXd.1760491696000.js";import"./pinia-GWTKVCoM.1760491696000.js";import"./pinia-plugin-persistedstate-n2tMOXAx.1760491696000.js";import"./vue-router-D9zjAgJy.1760491696000.js";import"./lodash-es-C9rdhAyu.1760491696000.js";import"./@iconify-C2dCaCa0.1760491696000.js";import"./@babel-Bq4_u9L9.1760491696000.js";import"./@ctrl-DOFZgDuz.1760491696000.js";import"./resize-observer-polyfill-B1PUzC5B.1760491696000.js";import"./dom-align-CRCehRfe.1760491696000.js";import"./async-validator-9PlIezaS.1760491696000.js";import"./scroll-into-view-if-needed-B3z4cY-J.1760491696000.js";import"./throttle-debounce-CUWDS_la.1760491696000.js";import"./vue-types-CF28atMM.1760491696000.js";import"./@emotion-BtrR-yrm.1760491696000.js";import"./stylis-D5iaQeiq.1760491696000.js";const y={getConfig(){return v({url:"/frame_extractor/config",method:"get"})},updateConfig(d){return v({url:"/frame_extractor/config",method:"post",data:d})},listTasks(){return v({url:"/frame_extractor/tasks",method:"get"})},addTask(d){return v({url:"/frame_extractor/tasks",method:"post",data:d})},delTask(d){return v({url:`/frame_extractor/tasks/${d}`,method:"delete"})}},_e={class:"p-4"},de={__name:"index",setup(d){const l=f({enable:!0,interval_ms:1e3,output_dir:"./snapshots",store:"local",minio:{endpoint:"",bucket:"",access_key:"",secret_key:"",use_ssl:!1,base_path:""}}),i=f({id:"",rtsp_url:"",interval_ms:1e3,output_path:""}),b=f(!1),x=f(!1),U=f([]),V=[{title:"任务ID",dataIndex:"id"},{title:"RTSP地址",dataIndex:"rtsp_url"},{title:"间隔(ms)",dataIndex:"interval_ms"},{title:"输出路径",dataIndex:"output_path"},{title:"操作",key:"action"}],D=async()=>{try{const{data:n}=await y.getConfig();n&&(l.value={...l.value,...n},l.value.minio||(l.value.minio={endpoint:"",bucket:"",access_key:"",secret_key:"",use_ssl:!1,base_path:""}))}catch(n){console.error("fetch config failed",n)}},F=async()=>{var n,t;if(l.value.store==="minio"&&(!l.value.minio.endpoint||!l.value.minio.bucket)){_.error("请填写MinIO Endpoint和Bucket");return}x.value=!0;try{await y.updateConfig(l.value),_.success("配置保存成功")}catch(s){_.error(((t=(n=s==null?void 0:s.response)==null?void 0:n.data)==null?void 0:t.error)||"配置保存失败")}finally{x.value=!1}},w=async()=>{const{data:n}=await y.listTasks();U.value=(n==null?void 0:n.items)||[]},P=async()=>{var n,t;if(!i.value.id||!i.value.rtsp_url){_.error("请填写任务ID与RTSP地址");return}b.value=!0;try{await y.addTask(i.value),_.success("保存成功"),await w()}catch(s){_.error(((t=(n=s==null?void 0:s.response)==null?void 0:n.data)==null?void 0:t.error)||"保存失败")}finally{b.value=!1}},A=async n=>{var t,s;try{await y.delTask(n),_.success("删除成功"),await w()}catch(c){_.error(((s=(t=c==null?void 0:c.response)==null?void 0:t.data)==null?void 0:s.error)||"删除失败")}};return j(()=>{D(),w()}),(n,t)=>{const s=ee,c=Y,u=Q,r=H,S=te,k=$,p=ae,T=le,E=oe,K=ne,L=ue,C=se,h=Z,B=W,N=re,R=ie;return g(),M("div",_e,[e(B,{title:"存储配置",class:"mb-4"},{default:a(()=>[e(h,{layout:"vertical"},{default:a(()=>[e(k,{gutter:16},{default:a(()=>[e(r,{span:12},{default:a(()=>[e(u,{label:"存储类型"},{default:a(()=>[e(c,{value:l.value.store,"onUpdate:value":t[0]||(t[0]=o=>l.value.store=o),style:{width:"100%"}},{default:a(()=>[e(s,{value:"local"},{default:a(()=>[...t[14]||(t[14]=[m("本地文件",-1)])]),_:1}),e(s,{value:"minio"},{default:a(()=>[...t[15]||(t[15]=[m("MinIO对象存储",-1)])]),_:1})]),_:1},8,["value"])]),_:1})]),_:1}),e(r,{span:12},{default:a(()=>[e(u,{label:"默认抽帧间隔(ms)"},{default:a(()=>[e(S,{value:l.value.interval_ms,"onUpdate:value":t[1]||(t[1]=o=>l.value.interval_ms=o),min:200,step:100,style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1})]),_:1}),l.value.store==="local"?(g(),O(u,{key:0,label:"本地输出目录"},{default:a(()=>[e(p,{value:l.value.output_dir,"onUpdate:value":t[2]||(t[2]=o=>l.value.output_dir=o),placeholder:"./snapshots"},null,8,["value"])]),_:1})):I("",!0),l.value.store==="minio"?(g(),M(q,{key:1},[e(T,{orientation:"left"},{default:a(()=>[...t[16]||(t[16]=[m("MinIO 配置",-1)])]),_:1}),e(k,{gutter:16},{default:a(()=>[e(r,{span:12},{default:a(()=>[e(u,{label:"Endpoint"},{default:a(()=>[e(p,{value:l.value.minio.endpoint,"onUpdate:value":t[3]||(t[3]=o=>l.value.minio.endpoint=o),placeholder:"minio.example.com:9000"},null,8,["value"])]),_:1})]),_:1}),e(r,{span:12},{default:a(()=>[e(u,{label:"Bucket"},{default:a(()=>[e(p,{value:l.value.minio.bucket,"onUpdate:value":t[4]||(t[4]=o=>l.value.minio.bucket=o),placeholder:"snapshots"},{suffix:a(()=>[e(E,{title:"自动创建不存在的bucket"},{default:a(()=>[e(z(pe),{style:{color:"rgba(0,0,0,.45)"}})]),_:1})]),_:1},8,["value"])]),_:1})]),_:1})]),_:1}),e(k,{gutter:16},{default:a(()=>[e(r,{span:12},{default:a(()=>[e(u,{label:"Access Key"},{default:a(()=>[e(p,{value:l.value.minio.access_key,"onUpdate:value":t[5]||(t[5]=o=>l.value.minio.access_key=o),placeholder:"access key"},null,8,["value"])]),_:1})]),_:1}),e(r,{span:12},{default:a(()=>[e(u,{label:"Secret Key"},{default:a(()=>[e(K,{value:l.value.minio.secret_key,"onUpdate:value":t[6]||(t[6]=o=>l.value.minio.secret_key=o),placeholder:"secret key"},null,8,["value"])]),_:1})]),_:1})]),_:1}),e(k,{gutter:16},{default:a(()=>[e(r,{span:12},{default:a(()=>[e(u,{label:"Base Path"},{default:a(()=>[e(p,{value:l.value.minio.base_path,"onUpdate:value":t[7]||(t[7]=o=>l.value.minio.base_path=o),placeholder:"camera-frames"},null,8,["value"])]),_:1})]),_:1}),e(r,{span:12},{default:a(()=>[e(u,{label:"使用 SSL"},{default:a(()=>[e(L,{checked:l.value.minio.use_ssl,"onUpdate:checked":t[8]||(t[8]=o=>l.value.minio.use_ssl=o)},null,8,["checked"])]),_:1})]),_:1})]),_:1})],64)):I("",!0),e(u,null,{default:a(()=>[e(C,{type:"primary",onClick:F,loading:x.value},{default:a(()=>[...t[17]||(t[17]=[m("保存配置",-1)])]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1}),e(B,{title:"抽帧任务"},{default:a(()=>[e(h,{layout:"inline",onSubmit:t[13]||(t[13]=G(()=>{},["prevent"]))},{default:a(()=>[e(u,{label:"任务ID"},{default:a(()=>[e(p,{value:i.value.id,"onUpdate:value":t[9]||(t[9]=o=>i.value.id=o),placeholder:"如 cam1",style:{width:"180px"}},null,8,["value"])]),_:1}),e(u,{label:"RTSP地址"},{default:a(()=>[e(p,{value:i.value.rtsp_url,"onUpdate:value":t[10]||(t[10]=o=>i.value.rtsp_url=o),placeholder:"rtsp://user:pass@ip:554/...",style:{width:"360px"}},null,8,["value"])]),_:1}),e(u,{label:"间隔(ms)"},{default:a(()=>[e(S,{value:i.value.interval_ms,"onUpdate:value":t[11]||(t[11]=o=>i.value.interval_ms=o),min:200,step:100,style:{width:"140px"}},null,8,["value"])]),_:1}),e(u,{label:"输出路径"},{default:a(()=>[e(p,{value:i.value.output_path,"onUpdate:value":t[12]||(t[12]=o=>i.value.output_path=o),placeholder:"cam1",style:{width:"160px"}},null,8,["value"])]),_:1}),e(u,null,{default:a(()=>[e(C,{type:"primary",onClick:P,loading:b.value},{default:a(()=>[...t[18]||(t[18]=[m("保存/替换",-1)])]),_:1},8,["loading"])]),_:1})]),_:1}),e(T),e(R,{"data-source":U.value,columns:V,"row-key":"id",pagination:!1},{bodyCell:a(({column:o,record:X})=>[o.key==="action"?(g(),O(N,{key:0,title:"确认删除?",onConfirm:()=>A(X.id)},{default:a(()=>[e(C,{type:"link",danger:""},{default:a(()=>[...t[19]||(t[19]=[m("删除",-1)])]),_:1})]),_:1},8,["onConfirm"])):I("",!0)]),_:1},8,["data-source"])]),_:1})])}}},qe=J(de,[["__scopeId","data-v-bc3fd3c7"]]);export{qe as default};
