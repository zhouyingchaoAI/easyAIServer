lanip = ''
serverid = 'local'
wanip = ''

[base]
disabledcaptcha = true
jwtsecret = ''
timeout = 0

[baselog]
dir = './logs'
level = 'info'
maxage = 2678400
rotationsize = 50
rotationtime = 28800

[data]
connmaxlifetime = 21600
dsn = './configs/data.db'
maxidleconns = 1
maxopenconns = 1
slowthreshold = 200

[defaulthttpconfig]
httplistenaddr = ':5066'
httpscertfile = './configs/cert.pem'
httpskeyfile = './configs/key.pem'
httpslistenaddr = ':24434'

[lalconfig]
httplistenaddr = ":8080"
httpslistenaddr = ""
httpscertfile = "./conf/cert.pem"
httpskeyfile = "./conf/key.pem"

[gopcacheconfig]
gopnum = 0
singlegopmaxframenum = 200

[hlsconfig]
boundarybyvideo = true
cleanupmode = 2
deletethreshold = 2
enable = true
enablehttps = false
fragmentdurationms = 6000
fragmentnum = 5
outpath = './stream/hls/'
subsessionhashkey = ''
subsessiontimeoutms = 20000
urlpattern = '/hls/'
usem3u8memoryflag = false
usememoryasdiskflag = false

[hlsconfig.fmp4]
enable = false
enablehttps = false
urlpattern = '/hls/m4s/*streamname'

[httpapiconfig]
enable = true

[httpflvconfig]
enable = true
enablehttps = false
urlpattern = '/'

[httpfmp4config]
enable = false
enablehttps = false
urlpattern = '/m4s/live/:streamname.mp4'

[httptsconfig]
enable = false
enablehttps = false
urlpattern = '/ts/live/:streamname'

[insessionconfig]
adddummyaudioenable = true
adddummyaudiowaitaudioms = 150

[logconfig]
assertbehavior = 1
filename = './logs/sugar.log'
isrotatedaily = true
istostdout = true
level = 4
levelflag = true
shortfileflag = true
timestampflag = true
timestampwithmsflag = true

[recordconfig]
enableflv = false
enablefmp4 = false
enablempegts = false
flvoutpath = './streamsvr_record/flv/'
fmp4outpath = './streamsvr_record/fmp4'
mpegtsoutpath = './r/'

[relaypush]
addrlist = []
enable = false

[roomconfig]
apikey = 'admin@admin'
apisecret = 'admin@admin'
enable = true

[rtcconfig]
enable = true
enablehttps = true
icehostnattoips = ['192.168.3.107']
icetcpmuxport = 24888
iceudpmuxport = 24888
pubtimeoutsec = 10
urlpattern = '/live/:streamname'

[rtmpconfig]
addr = ':21935'
enable = true
mergewritesize = 0
pubtimeoutsec = 0
pulltimeoutsec = 30
rtmpoverquicaddr = ':25935'
rtmpoverquicenable = true
rtmpsaddr = ':24935'
rtmpscertfile = './configs/cert.pem'
rtmpsenable = true
rtmpskeyfile = './configs/key.pem'

[rtspconfig]
addr = ':15544'
authenable = false
authmethod = 1
enable = true
outwaitkeyframeflag = true
password = 'admin'
pubtimeoutsec = 0
pulltimeoutsec = 30
rtspsaddr = ':5322'
rtspscertfile = './configs/cert.pem'
rtspsenable = true
rtspskeyfile = './configs/key.pem'
username = 'admin'
wsrtspaddr = ':25566'
wsrtspenable = true

[srtconfig]
addr = ':6000'
enable = false
encryptenable = false
encryptmode = 2
passphrase = 'streamsvr-password'
pubtimeoutsec = 0

[staticrelaypull]
addr = ''
enable = false

[storage]
bucket = ''
concurrency = 8
days = 3
diskusageratio = 85.95
enabledcloudstorage = false
endpoint = ''
format = 'mp4'
fragmentdurations = 20
key = ''
path = './r'
queuelength = 512
region = ''
retry = 0
secret = ''
timeout = 30000

[vodconfig]
dir = 'vod_data/vod'
srcdir = 'vod_data/vodsrc'
systrannumber = 3
progressnotifyurl = ""
hlstime = 8
opensquare = true
opendefinition = false
defaultdefinition = 'hd'
transdefinition = 'sd,hd,fhd'
transvideo = false
tranway = 'libx264'
tranhevcway = 'copy'

[frame_extractor]
enable = true
interval_ms = 1000
output_dir = './snapshots'
store = 'minio'
max_frame_count = 200  # 全局默认最大图片数量，0表示不限制
task_types = ['人数统计', '绊线人数统计', '人员跌倒', '人员离岗', '吸烟检测', '区域入侵', '徘徊检测', '物品遗留', '安全帽检测']

[frame_extractor.minio]
endpoint = '172.16.5.207:9000'
bucket = 'images'
access_key = 'admin'
secret_key = 'admin123'
use_ssl = false
base_path = ''

[[frame_extractor.tasks]]
id = '测试1'
task_type = '人数统计'
rtsp_url = 'rtsp://admin:HuaWei123@10.1.4.200:554/LiveMedia/ch1/Media1'
interval_ms = 200
output_path = '测试1'
enabled = true

[[frame_extractor.tasks]]
id = '测试2'
task_type = '人数统计'
rtsp_url = 'rtsp://admin:HuaWei123@10.1.4.200:554/LiveMedia/ch1/Media1'
interval_ms = 200
output_path = '测试2'
enabled = true

[[frame_extractor.tasks]]
id = '无人测试1'
task_type = '人数统计'
rtsp_url = 'rtsp://admin:HuaWei123@10.1.4.201:554/LiveMedia/ch1/Media1'
interval_ms = 200
output_path = '无人测试1'
enabled = true

[[frame_extractor.tasks]]
id = '无人测试2'
task_type = '人数统计'
rtsp_url = 'rtsp://admin:HuaWei123@10.1.4.201:554/LiveMedia/ch1/Media1'
interval_ms = 200
output_path = '无人测试2'
enabled = true

[[frame_extractor.tasks]]
id = '门口1'
task_type = '人数统计'
rtsp_url = 'rtsp://admin:HuaWei123@192.168.2.17:554/LiveMedia/ch1/Media1'
interval_ms = 200
output_path = '门口1'
enabled = true

[[frame_extractor.tasks]]
id = '门口2'
task_type = '人数统计'
rtsp_url = 'rtsp://admin:HuaWei123@192.168.2.17:554/LiveMedia/ch1/Media1'
interval_ms = 200
output_path = '门口2'
max_frame_count = 500  # 此任务最多保留500张图片
enabled = true

[[frame_extractor.tasks]]
id = '厕所1'
task_type = '人数统计'
rtsp_url = 'rtsp://admin:HuaWei123@192.168.2.9:554/LiveMedia/ch1/Media1'
interval_ms = 200
output_path = '厕所1'
enabled = true

[[frame_extractor.tasks]]
id = '厕所2'
task_type = '人数统计'
rtsp_url = 'rtsp://admin:HuaWei123@192.168.2.9:554/LiveMedia/ch1/Media1'
interval_ms = 200
output_path = '厕所2'
enabled = true

[[frame_extractor.tasks]]
id = '测试3'
task_type = '人数统计'
rtsp_url = 'rtsp://admin:HuaWei123@10.1.4.200:554/LiveMedia/ch1/Media1'
interval_ms = 200
output_path = '测试3'
enabled = true

[[frame_extractor.tasks]]
id = '无人测试3'
task_type = '人数统计'
rtsp_url = 'rtsp://admin:HuaWei123@10.1.4.201:554/LiveMedia/ch1/Media1'
interval_ms = 200
output_path = '无人测试3'
enabled = true

[[frame_extractor.tasks]]
id = '测试4'
task_type = '人数统计'
rtsp_url = 'rtsp://admin:HuaWei123@10.1.4.200:554/LiveMedia/ch1/Media1'
interval_ms = 200
output_path = '测试4'
enabled = true

[[frame_extractor.tasks]]
id = '无人测试4'
task_type = '人数统计'
rtsp_url = 'rtsp://admin:HuaWei123@10.1.4.201:554/LiveMedia/ch1/Media1'
interval_ms = 1000
output_path = '无人测试4'
enabled = true

[[frame_extractor.tasks]]
id = '测试5'
task_type = '人数统计'
rtsp_url = 'rtsp://admin:HuaWei123@10.1.4.200:554/LiveMedia/ch1/Media1'
interval_ms = 200
output_path = '测试5'
enabled = true

[[frame_extractor.tasks]]
id = '无人测试5'
task_type = '人数统计'
rtsp_url = 'rtsp://admin:HuaWei123@10.1.4.201:554/LiveMedia/ch1/Media1'
interval_ms = 200
output_path = '无人测试5'
enabled = true

[ai_analysis]
enable = true  # 启用智能分析插件
scan_interval_sec = 1  # MinIO扫描间隔（秒）
mq_type = 'kafka'  # 消息队列类型：kafka|rabbitmq
mq_address = '172.16.5.207:9092'  # 消息队列地址
mq_topic = 'easyai.alerts'  # 告警推送topic
heartbeat_timeout_sec = 60  # 算法服务心跳超时（秒）
max_concurrent_infer = 300  # 最大并发推理任务数
max_queue_size = 50000  # 推理队列最大容量，默认: 100，建议根据实际情况调整
save_only_with_detection = true  # 只保存有检测结果的告警，无检测结果的图片将被删除
alert_base_path = 'alerts/'  # 告警图片存储路径前缀，与抽帧路径分离

# 批量写入优化配置（降低数据库写入延迟）
alert_batch_enabled = true  # 启用批量写入（建议开启，可提升性能2-4倍）
alert_batch_size = 100  # 批量大小：达到此数量时触发写入
alert_batch_interval_sec = 2  # 刷新间隔：每隔N秒自动写入（即使未达到批量大小）
