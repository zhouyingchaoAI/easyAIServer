import{b as le}from"./vue-router-CJG71Oo3.1760507049000.js";import"./request-CTIq2jHo.1760507049000.js";import{f as D}from"./frameextractor-BGAs79Zg.1760507049000.js";import{_ as ae}from"./_plugin-vue_export-helper-DlAUqK2U.1760507049000.js";import{m as ne,r as ie,k as I,V as se,X as re,S as ue,h as de,B as _e,a3 as me,a4 as pe,K as ce,a1 as fe,c as ve,t as ge,s as ke,Y as ye,Z as we}from"./ant-design-vue-CaKETSag.1760507049000.js";import{r as v,f as Ce,j as he,Z as f,c as t,V as g,a1 as x,X as o,a9 as ze,W as s,F as O,_ as K,J as n,u as r,a3 as m,$ as u}from"./vue-DcFgi5qX.1760507049000.js";import{ak as Se,N as xe,aj as Oe,j as M,al as Be,F as be,A as U,am as Te,an as Ve,ao as Fe,G as Ne}from"./@ant-design-DU1tOc2n.1760507049000.js";import"./axios-ngrFHoWO.1760507049000.js";import"./qs-Cr-9-1rL.1760507049000.js";import"./clipboard-DnI0MzOy.1760507049000.js";import"./side-channel-D4tUDHLn.1760507049000.js";import"./crypto-js-DSJylPV1.1760507049000.js";import"./index-DPJYWQp6.1760507049000.js";import"./vue-i18n-D-JJ4q2Z.1760507049000.js";import"./@intlify-C7-MzqOv.1760507049000.js";import"./nprogress-Dm7o-FuV.1760507049000.js";/* empty css                                  */import"./dayjs-BsDAZE4w.1760507049000.js";import"./pinia-C8DwDjaK.1760507049000.js";import"./pinia-plugin-persistedstate-n2tMOXAx.1760507049000.js";import"./lodash-es-C9rdhAyu.1760507049000.js";import"./@iconify-BbADy1ey.1760507049000.js";import"./@babel-Bq4_u9L9.1760507049000.js";import"./@ctrl-DOFZgDuz.1760507049000.js";import"./resize-observer-polyfill-B1PUzC5B.1760507049000.js";import"./dom-align-CRCehRfe.1760507049000.js";import"./async-validator-9PlIezaS.1760507049000.js";import"./scroll-into-view-if-needed-B3z4cY-J.1760507049000.js";import"./throttle-debounce-CUWDS_la.1760507049000.js";import"./vue-types-CF28atMM.1760507049000.js";import"./@emotion-BtrR-yrm.1760507049000.js";import"./stylis-D5iaQeiq.1760507049000.js";const De={class:"p-4 gallery-container"},Ie={class:"card-title"},Me={class:"card-title"},Ue={key:0,class:"image-grid"},$e=["onClick"],je=["src","alt"],Ae={class:"image-overlay"},Ee={class:"image-info"},Le=["title"],qe={class:"meta"},Ke={class:"actions"},Pe=["src","onClick"],Re={class:"preview-content"},Xe=["src"],Ze={__name:"gallery",setup(Ge){const P=le(),k=v([]),d=v(null),_=v([]),y=v(!1),B=v("grid"),w=v(!1),C=v(null),R=[{title:"预览",key:"preview",width:100},{title:"文件名",key:"filename"},{title:"大小",key:"size",width:100},{title:"时间",key:"mod_time",width:180},{title:"操作",key:"action",width:150,fixed:"right"}],X=Ce(()=>_.value.reduce((e,i)=>e+i.size,0)/(1024*1024)),Z=async()=>{try{const{data:a}=await D.listTasks();k.value=(a==null?void 0:a.items)||[];const e=P.query.task;e&&k.value.find(i=>i.id===e)?(d.value=e,h()):k.value.length>0&&!d.value&&(d.value=k.value[0].id,h())}catch(a){console.error("fetch tasks failed",a)}},G=()=>{h()},h=async()=>{var a,e;if(d.value){y.value=!0;try{const{data:i}=await D.listSnapshots(d.value);_.value=(i==null?void 0:i.items)||[]}catch(i){I.error(((e=(a=i==null?void 0:i.response)==null?void 0:a.data)==null?void 0:e.error)||"获取快照列表失败")}finally{y.value=!1}}},S=a=>{C.value=a,w.value=!0},b=async a=>{var e,i;try{await D.deleteSnapshot(a.task_id,a.path),I.success("删除成功"),await h()}catch(z){I.error(((i=(e=z==null?void 0:z.response)==null?void 0:e.data)==null?void 0:i.error)||"删除失败")}},J=a=>{if(!a)return;const e=document.createElement("a");e.href=a.url,e.download=a.filename,e.click()},$=a=>a?new Date(a).toLocaleString("zh-CN"):"-",j=a=>a<1024?a+" B":a<1024*1024?(a/1024).toFixed(2)+" KB":(a/(1024*1024)).toFixed(2)+" MB";return he(Z),(a,e)=>{var q;const i=de,z=ue,T=re,p=_e,A=se,V=me,W=ze("a-statistic-group"),E=ne,L=we,Y=ye,F=ge,N=ce,H=ve,Q=fe,ee=pe,te=ke,oe=ie;return s(),f("div",De,[t(E,{bordered:!1,class:"mb-4"},{title:o(()=>[u("span",Ie,[t(r(Oe),{class:"title-icon"}),e[6]||(e[6]=n(" 抽帧结果查看 ",-1))])]),default:o(()=>[t(A,{gutter:16},{default:o(()=>[t(T,{xs:24,sm:16,md:12},{default:o(()=>[t(z,{value:d.value,"onUpdate:value":e[0]||(e[0]=l=>d.value=l),size:"large",placeholder:"选择任务查看快照",style:{width:"100%"},onChange:G},{default:o(()=>[(s(!0),f(O,null,K(k.value,l=>(s(),g(i,{key:l.id,value:l.id},{default:o(()=>[t(r(Se)),n(" "+m(l.id)+" - "+m(l.rtsp_url),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),t(T,{xs:24,sm:8,md:6},{default:o(()=>[t(p,{size:"large",onClick:h,loading:y.value},{icon:o(()=>[t(r(xe))]),default:o(()=>[e[7]||(e[7]=n(" 刷新 ",-1))]),_:1},8,["loading"])]),_:1})]),_:1}),d.value?(s(),g(A,{key:0,class:"mt-4"},{default:o(()=>[t(T,{span:24},{default:o(()=>[t(W,null,{default:o(()=>[t(V,{title:"总快照数",value:_.value.length},null,8,["value"]),t(V,{title:"总大小",value:X.value,suffix:"MB",precision:2},null,8,["value"]),t(V,{title:"最新快照",value:_.value.length>0?_.value[0].filename:"-"},null,8,["value"])]),_:1})]),_:1})]),_:1})):x("",!0)]),_:1}),d.value?(s(),g(E,{key:0,bordered:!1},{title:o(()=>[u("span",Me,[t(r(Fe),{class:"title-icon"}),n(" 快照列表 ("+m(_.value.length)+") ",1)])]),extra:o(()=>[t(F,null,{default:o(()=>[t(Y,{value:B.value,"onUpdate:value":e[1]||(e[1]=l=>B.value=l),"button-style":"solid",size:"large"},{default:o(()=>[t(L,{value:"grid"},{default:o(()=>[t(r(Te)),e[8]||(e[8]=n(" 网格 ",-1))]),_:1}),t(L,{value:"list"},{default:o(()=>[t(r(Ve)),e[9]||(e[9]=n(" 列表 ",-1))]),_:1})]),_:1},8,["value"])]),_:1})]),default:o(()=>[t(ee,{spinning:y.value},{default:o(()=>[B.value==="grid"?(s(),f("div",Ue,[(s(!0),f(O,null,K(_.value,l=>(s(),f("div",{key:l.path,class:"image-card"},[u("div",{class:"image-wrapper",onClick:()=>S(l)},[u("img",{src:l.url,alt:l.filename,loading:"lazy"},null,8,je),u("div",Ae,[t(r(M),{class:"preview-icon"})])],8,$e),u("div",Ee,[u("div",{class:"filename",title:l.filename},m(l.filename),9,Le),u("div",qe,[u("span",null,[t(r(Be)),n(" "+m($(l.mod_time)),1)]),u("span",null,[t(r(be)),n(" "+m(j(l.size)),1)])]),u("div",Ke,[t(p,{type:"primary",size:"small",onClick:()=>S(l)},{icon:o(()=>[t(r(M))]),default:o(()=>[e[10]||(e[10]=n(" 预览 ",-1))]),_:1},8,["onClick"]),t(N,{title:"确认删除?",onConfirm:()=>b(l)},{default:o(()=>[t(p,{danger:"",size:"small"},{icon:o(()=>[t(r(U))]),default:o(()=>[e[11]||(e[11]=n(" 删除 ",-1))]),_:1})]),_:1},8,["onConfirm"])])])]))),128))])):(s(),g(Q,{key:1,"data-source":_.value,columns:R,"row-key":"path",pagination:{pageSize:20,showTotal:l=>`共 ${l} 条`}},{bodyCell:o(({column:l,record:c})=>[l.key==="preview"?(s(),f("img",{key:0,src:c.url,class:"thumbnail",onClick:()=>S(c)},null,8,Pe)):l.key==="filename"?(s(),g(H,{key:1,title:c.path},{default:o(()=>[n(m(c.filename),1)]),_:2},1032,["title"])):l.key==="size"?(s(),f(O,{key:2},[n(m(j(c.size)),1)],64)):l.key==="mod_time"?(s(),f(O,{key:3},[n(m($(c.mod_time)),1)],64)):l.key==="action"?(s(),g(F,{key:4},{default:o(()=>[t(p,{type:"link",onClick:()=>S(c)},{icon:o(()=>[t(r(M))]),default:o(()=>[e[12]||(e[12]=n(" 预览 ",-1))]),_:1},8,["onClick"]),t(N,{title:"确认删除?",onConfirm:()=>b(c)},{default:o(()=>[t(p,{type:"link",danger:""},{icon:o(()=>[t(r(U))]),default:o(()=>[e[13]||(e[13]=n(" 删除 ",-1))]),_:1})]),_:1},8,["onConfirm"])]),_:2},1024)):x("",!0)]),_:1},8,["data-source","pagination"]))]),_:1},8,["spinning"]),!y.value&&_.value.length===0?(s(),g(te,{key:0,description:"暂无快照数据"})):x("",!0)]),_:1})):x("",!0),t(oe,{open:w.value,"onUpdate:open":e[5]||(e[5]=l=>w.value=l),footer:null,width:"80%",title:(q=C.value)==null?void 0:q.filename,centered:""},{footer:o(()=>[t(F,null,{default:o(()=>[t(p,{onClick:e[2]||(e[2]=l=>w.value=!1)},{default:o(()=>[...e[14]||(e[14]=[n("关闭",-1)])]),_:1}),t(p,{type:"primary",onClick:e[3]||(e[3]=l=>J(C.value))},{icon:o(()=>[t(r(Ne))]),default:o(()=>[e[15]||(e[15]=n(" 下载 ",-1))]),_:1}),t(N,{title:"确认删除?",onConfirm:e[4]||(e[4]=()=>{b(C.value),w.value=!1})},{default:o(()=>[t(p,{danger:""},{icon:o(()=>[t(r(U))]),default:o(()=>[e[16]||(e[16]=n(" 删除 ",-1))]),_:1})]),_:1})]),_:1})]),default:o(()=>{var l;return[u("div",Re,[u("img",{src:(l=C.value)==null?void 0:l.url,style:{width:"100%"}},null,8,Xe)])]}),_:1},8,["open","title"])])}}},Bt=ae(Ze,[["__scopeId","data-v-32885959"]]);export{Bt as default};
