import{u as ee}from"./vue-router-B2KU6MIN.1760498685000.js";import"./request-D-8GhmIt.1760498685000.js";import{f as x}from"./frameextractor-Gg8XZKC7.1760498685000.js";import{_ as te}from"./_plugin-vue_export-helper-DlAUqK2U.1760498685000.js";import{m as ae,F as le,V as oe,X as se,v as ne,S as ie,h as ue,g as re,f as de,I as pe,z as _e,a2 as me,c as ce,w as fe,B as ve,a1 as ge,T as ye,t as ke,K as be,k as f}from"./ant-design-vue-DV0k208e.1760498685000.js";import{y as z,aa as xe,x as Oe,ab as K,ac as we,I as he,ad as ze,ae as Ce,X as Te,af as Ie,ag as Se,ah as Ue,P as Be,ai as N,a4 as Me,A as Pe,aj as De}from"./@ant-design-GuLqSJkw.1760498685000.js";import{r as O,j as Ve,Z as P,c as e,X as t,W as m,V as y,a1 as C,J as u,u as s,F as Ae,$ as w,a3 as v}from"./vue-DcFgi5qX.1760498685000.js";import"./axios-ngrFHoWO.1760498685000.js";import"./qs-BZrrPWSH.1760498685000.js";import"./clipboard-DnI0MzOy.1760498685000.js";import"./side-channel-8rcBluLJ.1760498685000.js";import"./crypto-js-a7VQsrW5.1760498685000.js";import"./index-CvRygseu.1760498685000.js";import"./vue-i18n-BOPlSK7N.1760498685000.js";import"./@intlify-C7-MzqOv.1760498685000.js";import"./nprogress-CkdTEmv7.1760498685000.js";/* empty css                                  */import"./dayjs-yGRgsX5b.1760498685000.js";import"./pinia-BB5XkdoI.1760498685000.js";import"./pinia-plugin-persistedstate-n2tMOXAx.1760498685000.js";import"./lodash-es-C9rdhAyu.1760498685000.js";import"./@iconify-EF6tayvU.1760498685000.js";import"./@babel-Bq4_u9L9.1760498685000.js";import"./@ctrl-DOFZgDuz.1760498685000.js";import"./resize-observer-polyfill-B1PUzC5B.1760498685000.js";import"./dom-align-CRCehRfe.1760498685000.js";import"./async-validator-9PlIezaS.1760498685000.js";import"./scroll-into-view-if-needed-B3z4cY-J.1760498685000.js";import"./throttle-debounce-CUWDS_la.1760498685000.js";import"./vue-types-CF28atMM.1760498685000.js";import"./@emotion-BtrR-yrm.1760498685000.js";import"./stylis-D5iaQeiq.1760498685000.js";const Fe={class:"p-4 frame-extractor-container"},Ee={class:"card-title"},Le={class:"card-title"},Ke={class:"rtsp-url"},Ne={key:3},Re={style:{"max-width":"250px"}},$e={__name:"index",setup(qe){const D=ee(),l=O({enable:!0,interval_ms:1e3,output_dir:"./snapshots",store:"local",minio:{endpoint:"",bucket:"",access_key:"",secret_key:"",use_ssl:!1,base_path:""}}),r=O({id:"",rtsp_url:"",interval_ms:1e3,output_path:""}),T=O(!1),I=O(!1),S=O([]),R=[{title:"任务ID",key:"id",width:120},{title:"RTSP地址",key:"rtsp_url",ellipsis:!0},{title:"间隔",key:"interval_ms",width:100},{title:"输出路径",key:"output_path",width:150},{title:"操作",key:"action",width:180,fixed:"right"}],$=async()=>{try{const{data:n}=await x.getConfig();n&&(l.value={...l.value,...n},l.value.minio||(l.value.minio={endpoint:"",bucket:"",access_key:"",secret_key:"",use_ssl:!1,base_path:""}))}catch(n){console.error("fetch config failed",n)}},q=async()=>{var n,a;if(l.value.store==="minio"&&(!l.value.minio.endpoint||!l.value.minio.bucket)){f.error("请填写MinIO Endpoint和Bucket");return}I.value=!0;try{await x.updateConfig(l.value),f.success("配置保存成功")}catch(d){f.error(((a=(n=d==null?void 0:d.response)==null?void 0:n.data)==null?void 0:a.error)||"配置保存失败")}finally{I.value=!1}},U=async()=>{const{data:n}=await x.listTasks();S.value=(n==null?void 0:n.items)||[]},X=async()=>{var n,a;if(!r.value.id||!r.value.rtsp_url){f.error("请填写任务ID与RTSP地址");return}T.value=!0;try{await x.addTask(r.value),f.success("任务添加成功"+(l.value.store==="minio"?"，MinIO路径已创建":"")),r.value={id:"",rtsp_url:"",interval_ms:1e3,output_path:""},await U()}catch(d){f.error(((a=(n=d==null?void 0:d.response)==null?void 0:n.data)==null?void 0:a.error)||"添加失败")}finally{T.value=!1}},j=n=>{r.value={...n},window.scrollTo({top:0,behavior:"smooth"})},G=async n=>{var a,d;try{await x.delTask(n),f.success("任务删除成功"+(l.value.store==="minio"?"，MinIO路径已清理":"")),await U()}catch(k){f.error(((d=(a=k==null?void 0:k.response)==null?void 0:a.data)==null?void 0:d.error)||"删除失败")}},H=()=>{D.push("/frame-extractor/gallery")},J=n=>{D.push({path:"/frame-extractor/gallery",query:{task:n}})};return Ve(()=>{$(),U()}),(n,a)=>{const d=ue,k=ie,i=ne,p=se,V=re,A=de,b=oe,c=pe,W=_e,F=me,h=ce,Z=fe,g=ve,E=le,B=ae,M=ye,L=ke,Q=be,Y=ge;return m(),P("div",Fe,[e(B,{bordered:!1,class:"config-card mb-4"},{title:t(()=>[w("span",Ee,[e(s(K),{class:"title-icon"}),a[14]||(a[14]=u(" 存储配置 ",-1))])]),default:t(()=>[e(E,{model:l.value,layout:"vertical"},{default:t(()=>[e(b,{gutter:24},{default:t(()=>[e(p,{xs:24,sm:12,md:8},{default:t(()=>[e(i,{label:"存储类型"},{default:t(()=>[e(k,{value:l.value.store,"onUpdate:value":a[0]||(a[0]=o=>l.value.store=o),size:"large"},{default:t(()=>[e(d,{value:"local"},{default:t(()=>[e(s(z)),a[15]||(a[15]=u(" 本地文件系统 ",-1))]),_:1}),e(d,{value:"minio"},{default:t(()=>[e(s(xe)),a[16]||(a[16]=u(" MinIO对象存储 ",-1))]),_:1})]),_:1},8,["value"])]),_:1})]),_:1}),e(p,{xs:24,sm:12,md:8},{default:t(()=>[e(i,{label:"默认抽帧间隔"},{default:t(()=>[e(V,{value:l.value.interval_ms,"onUpdate:value":a[1]||(a[1]=o=>l.value.interval_ms=o),min:200,step:100,size:"large",style:{width:"100%"}},{addonAfter:t(()=>[...a[17]||(a[17]=[u("毫秒",-1)])]),_:1},8,["value"])]),_:1})]),_:1}),e(p,{xs:24,sm:12,md:8},{default:t(()=>[e(i,{label:"启用状态"},{default:t(()=>[e(A,{checked:l.value.enable,"onUpdate:checked":a[2]||(a[2]=o=>l.value.enable=o),size:"large","checked-children":"已启用","un-checked-children":"已禁用"},null,8,["checked"])]),_:1})]),_:1})]),_:1}),l.value.store==="local"?(m(),y(i,{key:0,label:"本地输出目录"},{default:t(()=>[e(c,{value:l.value.output_dir,"onUpdate:value":a[3]||(a[3]=o=>l.value.output_dir=o),size:"large",placeholder:"./snapshots"},{prefix:t(()=>[e(s(Oe))]),_:1},8,["value"])]),_:1})):C("",!0),l.value.store==="minio"?(m(),P(Ae,{key:1},[e(W,{orientation:"left"},{default:t(()=>[e(s(K)),a[18]||(a[18]=u(" MinIO 配置 ",-1))]),_:1}),e(F,{message:"提示",description:"Bucket不存在时会自动创建，任务ID会作为子路径，删除任务时会同步删除MinIO对应路径下的所有文件",type:"info","show-icon":"",class:"mb-4"}),e(b,{gutter:24},{default:t(()=>[e(p,{xs:24,sm:12},{default:t(()=>[e(i,{label:"Endpoint"},{default:t(()=>[e(c,{value:l.value.minio.endpoint,"onUpdate:value":a[4]||(a[4]=o=>l.value.minio.endpoint=o),size:"large",placeholder:"minio.example.com:9000"},{prefix:t(()=>[e(s(we))]),_:1},8,["value"])]),_:1})]),_:1}),e(p,{xs:24,sm:12},{default:t(()=>[e(i,{label:"Bucket"},{default:t(()=>[e(c,{value:l.value.minio.bucket,"onUpdate:value":a[5]||(a[5]=o=>l.value.minio.bucket=o),size:"large",placeholder:"snapshots"},{prefix:t(()=>[e(s(ze))]),suffix:t(()=>[e(h,{title:"不存在时会自动创建"},{default:t(()=>[e(s(he),{style:{color:"rgba(0,0,0,.45)"}})]),_:1})]),_:1},8,["value"])]),_:1})]),_:1})]),_:1}),e(b,{gutter:24},{default:t(()=>[e(p,{xs:24,sm:12},{default:t(()=>[e(i,{label:"Access Key"},{default:t(()=>[e(c,{value:l.value.minio.access_key,"onUpdate:value":a[6]||(a[6]=o=>l.value.minio.access_key=o),size:"large",placeholder:"access key"},{prefix:t(()=>[e(s(Ce))]),_:1},8,["value"])]),_:1})]),_:1}),e(p,{xs:24,sm:12},{default:t(()=>[e(i,{label:"Secret Key"},{default:t(()=>[e(Z,{value:l.value.minio.secret_key,"onUpdate:value":a[7]||(a[7]=o=>l.value.minio.secret_key=o),size:"large",placeholder:"secret key"},{prefix:t(()=>[e(s(Te))]),_:1},8,["value"])]),_:1})]),_:1})]),_:1}),e(b,{gutter:24},{default:t(()=>[e(p,{xs:24,sm:12},{default:t(()=>[e(i,{label:"Base Path (可选)"},{default:t(()=>[e(c,{value:l.value.minio.base_path,"onUpdate:value":a[8]||(a[8]=o=>l.value.minio.base_path=o),size:"large",placeholder:"camera-frames"},{prefix:t(()=>[e(s(z))]),_:1},8,["value"])]),_:1})]),_:1}),e(p,{xs:24,sm:12},{default:t(()=>[e(i,{label:"使用 SSL"},{default:t(()=>[e(A,{checked:l.value.minio.use_ssl,"onUpdate:checked":a[9]||(a[9]=o=>l.value.minio.use_ssl=o),size:"large","checked-children":"HTTPS","un-checked-children":"HTTP"},null,8,["checked"])]),_:1})]),_:1})]),_:1})],64)):C("",!0),e(i,null,{default:t(()=>[e(g,{type:"primary",size:"large",onClick:q,loading:I.value},{icon:t(()=>[e(s(Ie))]),default:t(()=>[a[19]||(a[19]=u(" 保存配置 ",-1))]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),_:1}),e(B,{bordered:!1,class:"task-card"},{title:t(()=>[w("span",Le,[e(s(De),{class:"title-icon"}),u(" 抽帧任务 ("+v(S.value.length)+") ",1)])]),extra:t(()=>[e(L,null,{default:t(()=>[e(M,{color:l.value.store==="minio"?"blue":"green"},{default:t(()=>[u(v(l.value.store==="minio"?"MinIO存储":"本地存储"),1)]),_:1},8,["color"]),e(g,{type:"primary",onClick:H},{icon:t(()=>[e(s(N))]),default:t(()=>[a[20]||(a[20]=u(" 查看抽帧结果 ",-1))]),_:1})]),_:1})]),default:t(()=>[e(B,{class:"add-task-card mb-4",bordered:!1},{default:t(()=>[e(E,{model:r.value,layout:"vertical"},{default:t(()=>[e(b,{gutter:16},{default:t(()=>[e(p,{xs:24,sm:12,md:6},{default:t(()=>[e(i,{label:"任务ID",required:!0},{default:t(()=>[e(c,{value:r.value.id,"onUpdate:value":a[10]||(a[10]=o=>r.value.id=o),size:"large",placeholder:"如 cam1"},{prefix:t(()=>[e(s(Se))]),_:1},8,["value"])]),_:1})]),_:1}),e(p,{xs:24,sm:12,md:10},{default:t(()=>[e(i,{label:"RTSP地址",required:!0},{default:t(()=>[e(c,{value:r.value.rtsp_url,"onUpdate:value":a[11]||(a[11]=o=>r.value.rtsp_url=o),size:"large",placeholder:"rtsp://user:pass@ip:554/..."},{prefix:t(()=>[e(s(Ue))]),_:1},8,["value"])]),_:1})]),_:1}),e(p,{xs:24,sm:12,md:4},{default:t(()=>[e(i,{label:"间隔(ms)"},{default:t(()=>[e(V,{value:r.value.interval_ms,"onUpdate:value":a[12]||(a[12]=o=>r.value.interval_ms=o),min:200,step:100,size:"large",style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1}),e(p,{xs:24,sm:12,md:4},{default:t(()=>[e(i,{label:"输出路径"},{default:t(()=>[e(c,{value:r.value.output_path,"onUpdate:value":a[13]||(a[13]=o=>r.value.output_path=o),size:"large",placeholder:"cam1"},{prefix:t(()=>[e(s(z))]),_:1},8,["value"])]),_:1})]),_:1})]),_:1}),e(i,null,{default:t(()=>[e(g,{type:"primary",size:"large",onClick:X,loading:T.value},{icon:t(()=>[e(s(Be))]),default:t(()=>[a[21]||(a[21]=u(" 添加任务 ",-1))]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),_:1}),e(Y,{"data-source":S.value,columns:R,"row-key":"id",pagination:{pageSize:10,showTotal:o=>`共 ${o} 条`},scroll:{x:800}},{bodyCell:t(({column:o,record:_})=>[o.key==="id"?(m(),y(M,{key:0,color:"blue"},{default:t(()=>[u(v(_.id),1)]),_:2},1024)):o.key==="rtsp_url"?(m(),y(h,{key:1,title:_.rtsp_url},{default:t(()=>[w("span",Ke,v(_.rtsp_url),1)]),_:2},1032,["title"])):o.key==="interval_ms"?(m(),y(M,{key:2,color:"green"},{default:t(()=>[u(v(_.interval_ms)+"ms",1)]),_:2},1024)):o.key==="output_path"?(m(),P("span",Ne,[e(s(z)),u(" "+v(_.output_path),1)])):o.key==="action"?(m(),y(L,{key:4},{default:t(()=>[e(h,{title:"查看快照"},{default:t(()=>[e(g,{type:"default",size:"small",onClick:()=>J(_.id)},{icon:t(()=>[e(s(N))]),_:1},8,["onClick"])]),_:2},1024),e(h,{title:"编辑"},{default:t(()=>[e(g,{type:"primary",size:"small",onClick:()=>j(_)},{icon:t(()=>[e(s(Me))]),_:1},8,["onClick"])]),_:2},1024),e(Q,{title:"确认删除?","ok-text":"删除","cancel-text":"取消",onConfirm:()=>G(_.id)},{description:t(()=>[w("div",Re,[l.value.store==="minio"?(m(),y(F,{key:0,message:"将同时删除MinIO中的所有文件",type:"warning","show-icon":"",banner:!0,style:{"margin-bottom":"8px"}})):C("",!0),a[22]||(a[22]=u(" 此操作不可恢复，确认删除任务 ",-1)),w("strong",null,v(_.id),1),a[23]||(a[23]=u(" 吗？ ",-1))])]),default:t(()=>[e(g,{danger:"",size:"small"},{icon:t(()=>[e(s(Pe))]),_:1})]),_:2},1032,["onConfirm"])]),_:2},1024)):C("",!0)]),_:1},8,["data-source","pagination"])]),_:1})])}}},wt=te($e,[["__scopeId","data-v-031449d8"]]);export{wt as default};
