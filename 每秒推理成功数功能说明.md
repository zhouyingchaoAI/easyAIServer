# 每秒推理成功数功能说明

## ✅ 功能已实现

### 1. 后端实现
- **位置**: `internal/plugin/aianalysis/monitor.go`
- **功能**: 使用滑动窗口计算每秒推理成功数
- **字段**: `success_rate_per_sec` (float64)
- **API路由**: `/ai_analysis/inference_stats` (GET)
- **返回字段**: `success_rate_per_sec`

### 2. 前端实现
- **位置**: `web-src/src/views/frame-extractor/monitor.vue`
- **显示位置**: AI推理队列监控区域，在"推理成功"和"推理失败"下方
- **样式**: 渐变紫色背景卡片，带闪电图标
- **字段绑定**: `inferenceStats.success_rate_per_sec`

### 3. 编译状态
- ✅ 前端代码已编译到 `web-src/web/`
- ✅ 编译后的代码已复制到项目根目录 `web/`
- ✅ 编译后的代码包含 `success_rate_per_sec` 字段

## 🔍 如果看不到功能，请检查：

### 1. 清除浏览器缓存
```bash
# 在浏览器中按 Ctrl+Shift+R (Windows/Linux) 或 Cmd+Shift+R (Mac) 强制刷新
# 或者清除浏览器缓存
```

### 2. 重启服务
```bash
# 停止服务
./stop.sh

# 启动服务
./start.sh
```

### 3. 检查后端数据
```bash
# 测试API是否返回数据
curl http://localhost:5066/api/v1/ai_analysis/inference_stats

# 应该看到 success_rate_per_sec 字段
```

### 4. 检查前端控制台
- 打开浏览器开发者工具 (F12)
- 查看 Console 标签，检查是否有错误
- 查看 Network 标签，检查 `/ai_analysis/inference_stats` 请求是否成功
- 查看返回的 JSON 数据是否包含 `success_rate_per_sec` 字段

### 5. 检查AI分析服务是否启用
```bash
# 检查配置文件
grep -A 5 "\[ai_analysis\]" configs/config.toml

# 应该看到 enable = true
```

## 📍 功能显示位置

在"抽帧服务监控"页面中：
1. 找到"AI推理队列"卡片
2. 在"推理成功"和"推理失败"统计下方
3. 会看到一个**紫色渐变背景的卡片**，显示"每秒推理成功数"
4. 带有⚡闪电图标，单位是"张/秒"

## 🐛 常见问题

### Q: 为什么显示为 0.00？
A: 可能的原因：
1. 系统刚启动，还没有推理成功
2. 算法服务未注册或不可用
3. 没有图片在进行推理

### Q: 为什么看不到这个卡片？
A: 可能的原因：
1. 浏览器缓存了旧的前端代码（需要强制刷新）
2. 服务没有重启（需要重启服务）
3. 前端编译文件没有正确复制到 `web/` 目录

### Q: 如何验证功能是否正常？
A: 
1. 确保有算法服务注册并运行
2. 确保有抽帧任务在运行
3. 等待几秒钟，让系统进行推理
4. 刷新监控页面，应该看到 `success_rate_per_sec` 有数值

## 📝 技术细节

### 后端计算逻辑
- 使用1秒滑动窗口
- 每次推理成功时更新计数
- 每秒计算一次：`success_rate_per_sec = successCountInWindow / windowDuration`

### 前端显示逻辑
- 从 `/ai_analysis/inference_stats` API 获取数据
- 绑定到 `inferenceStats.success_rate_per_sec`
- 使用 `a-statistic` 组件显示，精度为2位小数
- 样式：白色文字，28px字体，渐变紫色背景

