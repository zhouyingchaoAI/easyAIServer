import{u as Q}from"./vue-router-CejI8kZH.1760592814000.js";import"./request-TovLtS-n.1760592814000.js";import{f as Y}from"./frameextractor-DIAW2lRu.1760592814000.js";import{a as V}from"./alert-BGKTTlIa.1760592814000.js";import{_ as ee}from"./_plugin-vue_export-helper-DlAUqK2U.1760592814000.js";import{m as te,r as ae,k as z,V as le,X as oe,S as se,h as ne,I as ie,B as re,a1 as _e,T as ue,N as pe,c as ce,t as de,K as me,D as fe,d as ke}from"./ant-design-vue-CmOskzso.1760592814000.js";import{S as j,j as ye,A as ge,N as ve,ac as he,ap as we}from"./@ant-design-C3wDnhRS.1760592814000.js";import{r as k,j as Ce,Z as h,c as t,X as e,W as r,J as s,F as D,_ as be,V as c,a3 as n,u as y,a1 as M,$ as d}from"./vue-DcFgi5qX.1760592814000.js";import"./axios-ngrFHoWO.1760592814000.js";import"./qs-Cx3-d1UP.1760592814000.js";import"./clipboard-DnI0MzOy.1760592814000.js";import"./side-channel-C8d6-l42.1760592814000.js";import"./crypto-js-3ldLspai.1760592814000.js";import"./index-NG6300BF.1760592814000.js";import"./vue-i18n-DoXG6fUQ.1760592814000.js";import"./@intlify-C7-MzqOv.1760592814000.js";import"./nprogress-o1QHtQQM.1760592814000.js";/* empty css                                  */import"./dayjs-W9-eE6A9.1760592814000.js";import"./pinia-DQJINFak.1760592814000.js";import"./pinia-plugin-persistedstate-n2tMOXAx.1760592814000.js";import"./lodash-es-C9rdhAyu.1760592814000.js";import"./@iconify-BBSLV3A2.1760592814000.js";import"./@babel-Bq4_u9L9.1760592814000.js";import"./@ctrl-DOFZgDuz.1760592814000.js";import"./resize-observer-polyfill-B1PUzC5B.1760592814000.js";import"./dom-align-CRCehRfe.1760592814000.js";import"./async-validator-9PlIezaS.1760592814000.js";import"./scroll-into-view-if-needed-B3z4cY-J.1760592814000.js";import"./throttle-debounce-CUWDS_la.1760592814000.js";import"./vue-types-CF28atMM.1760592814000.js";import"./@emotion-BtrR-yrm.1760592814000.js";import"./stylis-D5iaQeiq.1760592814000.js";const xe={class:"p-4 alerts-container"},ze={class:"card-title"},De={class:"image-path"},Se={key:0},Te=["src"],Ie={class:"text-gray-500 text-xs"},Ne={class:"result-json"},Oe={__name:"index",setup(Ae){const E=Q(),C=k(!1),S=k([]),T=k([]),b=k(!1),i=k(null),u=k({task_id:"",task_type:"",page:1,page_size:20}),x=k({current:1,pageSize:20,total:0,showSizeChanger:!0,showTotal:a=>`共 ${a} 条`}),J=[{title:"ID",key:"id",width:80},{title:"任务类型",key:"task_type",width:120},{title:"任务ID",key:"task_id",width:150},{title:"算法",key:"algorithm_name",width:150},{title:"置信度",key:"confidence",width:120},{title:"图片路径",key:"image_path",ellipsis:!0},{title:"推理时间",key:"inference_time_ms",width:100},{title:"告警时间",key:"created_at",width:180},{title:"操作",key:"action",width:150,fixed:"right"}],m=async()=>{C.value=!0;try{const{data:a}=await V.listAlerts(u.value);S.value=(a==null?void 0:a.items)||[],x.value.total=(a==null?void 0:a.total)||0,x.value.current=u.value.page}catch(a){console.error("fetch alerts failed",a),z.error("加载告警列表失败")}finally{C.value=!1}},R=async()=>{try{const{data:a}=await Y.getTaskTypes();T.value=(a==null?void 0:a.task_types)||[]}catch(a){console.error("fetch task types failed",a)}},U=a=>{u.value.page=a.current,u.value.page_size=a.pageSize,m()},$=a=>{i.value=a,b.value=!0},F=async a=>{try{await V.deleteAlert(a),z.success("告警已删除"),m()}catch{z.error("删除失败")}},I=a=>a?new Date(a).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}):"-",L=a=>{try{const l=JSON.parse(a);return JSON.stringify(l,null,2)}catch{return a}},X=()=>{E.push("/ai-services")};return Ce(()=>{m(),R()}),(a,l)=>{const g=re,N=de,O=ne,K=se,v=oe,P=ie,A=le,f=ue,B=pe,W=ce,Z=me,q=_e,w=te,p=ke,G=fe,H=ae;return r(),h("div",xe,[t(w,{bordered:!1,class:"alerts-card"},{title:e(()=>[d("span",ze,[t(y(we),{class:"title-icon"}),l[3]||(l[3]=s(" 智能分析告警 ",-1))])]),extra:e(()=>[t(N,null,{default:e(()=>[t(g,{onClick:m,size:"small"},{icon:e(()=>[t(y(ve))]),default:e(()=>[l[4]||(l[4]=s(" 刷新 ",-1))]),_:1}),t(g,{type:"link",onClick:X},{icon:e(()=>[t(y(he))]),default:e(()=>[l[5]||(l[5]=s(" 算法服务 ",-1))]),_:1})]),_:1})]),default:e(()=>[t(A,{gutter:16,class:"mb-4"},{default:e(()=>[t(v,{xs:24,sm:8,md:6},{default:e(()=>[t(K,{value:u.value.task_type,"onUpdate:value":l[0]||(l[0]=o=>u.value.task_type=o),placeholder:"任务类型","allow-clear":"",size:"large",onChange:m},{default:e(()=>[t(O,{value:""},{default:e(()=>[...l[6]||(l[6]=[s("全部类型",-1)])]),_:1}),(r(!0),h(D,null,be(T.value,o=>(r(),c(O,{key:o,value:o},{default:e(()=>[s(n(o),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),t(v,{xs:24,sm:8,md:6},{default:e(()=>[t(P,{value:u.value.task_id,"onUpdate:value":l[1]||(l[1]=o=>u.value.task_id=o),placeholder:"任务ID","allow-clear":"",size:"large",onPressEnter:m},{prefix:e(()=>[t(y(j))]),_:1},8,["value"])]),_:1}),t(v,{xs:24,sm:8,md:6},{default:e(()=>[t(g,{type:"primary",size:"large",onClick:m},{icon:e(()=>[t(y(j))]),default:e(()=>[l[7]||(l[7]=s(" 查询 ",-1))]),_:1})]),_:1})]),_:1}),t(q,{"data-source":S.value,columns:J,loading:C.value,"row-key":"id",pagination:x.value,onChange:U,scroll:{x:1400}},{bodyCell:e(({column:o,record:_})=>[o.key==="id"?(r(),c(f,{key:0,color:"blue"},{default:e(()=>[s("#"+n(_.id),1)]),_:2},1024)):o.key==="task_type"?(r(),c(f,{key:1,color:"purple"},{default:e(()=>[s(n(_.task_type),1)]),_:2},1024)):o.key==="task_id"?(r(),c(f,{key:2,color:"cyan"},{default:e(()=>[s(n(_.task_id),1)]),_:2},1024)):o.key==="algorithm_name"?(r(),c(f,{key:3,color:"green"},{default:e(()=>[s(n(_.algorithm_name),1)]),_:2},1024)):o.key==="confidence"?(r(),c(B,{key:4,percent:Math.round(_.confidence*100),strokeColor:_.confidence>.8?"#52c41a":"#faad14",size:"small"},null,8,["percent","strokeColor"])):o.key==="image_path"?(r(),c(W,{key:5,title:_.image_path},{default:e(()=>[d("span",De,n(_.image_path),1)]),_:2},1032,["title"])):o.key==="created_at"?(r(),h(D,{key:6},[s(n(I(_.created_at)),1)],64)):o.key==="inference_time_ms"?(r(),h(D,{key:7},[s(n(_.inference_time_ms)+"ms ",1)],64)):o.key==="action"?(r(),c(N,{key:8},{default:e(()=>[t(g,{type:"primary",size:"small",onClick:()=>$(_)},{icon:e(()=>[t(y(ye))]),default:e(()=>[l[8]||(l[8]=s(" 查看 ",-1))]),_:1},8,["onClick"]),t(Z,{title:"确认删除?",onConfirm:()=>F(_.id)},{default:e(()=>[t(g,{danger:"",size:"small"},{icon:e(()=>[t(y(ge))]),_:1})]),_:1},8,["onConfirm"])]),_:2},1024)):M("",!0)]),_:1},8,["data-source","loading","pagination"])]),_:1}),t(H,{open:b.value,"onUpdate:open":l[2]||(l[2]=o=>b.value=o),title:"告警详情",width:"80%",footer:null},{default:e(()=>[i.value?(r(),h("div",Se,[t(A,{gutter:24},{default:e(()=>[t(v,{xs:24,md:12},{default:e(()=>[t(w,{title:"图片预览",size:"small"},{default:e(()=>[d("img",{src:i.value.image_url,style:{width:"100%"}},null,8,Te)]),_:1})]),_:1}),t(v,{xs:24,md:12},{default:e(()=>[t(w,{title:"告警信息",size:"small"},{default:e(()=>[t(G,{column:1,bordered:"",size:"small"},{default:e(()=>[t(p,{label:"告警ID"},{default:e(()=>[s(" #"+n(i.value.id),1)]),_:1}),t(p,{label:"任务ID"},{default:e(()=>[t(f,{color:"cyan"},{default:e(()=>[s(n(i.value.task_id),1)]),_:1})]),_:1}),t(p,{label:"任务类型"},{default:e(()=>[t(f,{color:"purple"},{default:e(()=>[s(n(i.value.task_type),1)]),_:1})]),_:1}),t(p,{label:"算法"},{default:e(()=>[d("div",null,[t(f,{color:"green"},{default:e(()=>[s(n(i.value.algorithm_name),1)]),_:1}),l[9]||(l[9]=d("br",null,null,-1)),d("span",Ie,n(i.value.algorithm_id),1)])]),_:1}),t(p,{label:"置信度"},{default:e(()=>[t(B,{percent:Math.round(i.value.confidence*100),strokeColor:i.value.confidence>.8?"#52c41a":"#faad14"},null,8,["percent","strokeColor"])]),_:1}),t(p,{label:"推理时间"},{default:e(()=>[s(n(i.value.inference_time_ms)+"ms ",1)]),_:1}),t(p,{label:"图片路径"},{default:e(()=>[d("code",null,n(i.value.image_path),1)]),_:1}),t(p,{label:"告警时间"},{default:e(()=>[s(n(I(i.value.created_at)),1)]),_:1})]),_:1})]),_:1}),t(w,{title:"推理结果",size:"small",class:"mt-3"},{default:e(()=>[d("pre",Ne,n(L(i.value.result)),1)]),_:1})]),_:1})]),_:1})])):M("",!0)]),_:1},8,["open"])])}}},ct=ee(Oe,[["__scopeId","data-v-904af815"]]);export{ct as default};
