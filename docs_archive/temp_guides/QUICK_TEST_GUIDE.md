# 前端修复快速测试指南

## 🎯 测试目标

验证以下两个问题已修复：
1. ✅ 算法参数配置可以正常回显（无需关闭再打开）
2. ✅ 告警详情同时显示配置区域和检测结果

---

## 📋 测试前准备

### 1. 重新编译前端

```bash
cd web-src
npm install  # 如果之前没安装
npm run build
```

### 2. 重启服务

```bash
# 停止服务
./stop.sh  # 或 systemctl stop easydarwin

# 启动服务
./start.sh  # 或 systemctl start easydarwin
```

### 3. 打开浏览器

```
http://localhost:5066
```

---

## 🧪 测试场景1：算法配置回显

### 步骤：

1. **进入抽帧管理**
   ```
   侧边栏 → 抽帧管理
   ```

2. **选择一个任务并配置**
   - 点击任务的"算法配置"按钮（设置图标）
   - 在弹出的画布中绘制区域：
     - 点击"绘制线"，在画布上点击两次
     - 点击"绘制矩形"，在画布上点击对角两次
     - 点击"绘制多边形"，点击多次，双击完成
   - 在右侧配置面板修改区域属性（颜色、方向等）
   - 点击"保存配置"

3. **测试回显**
   - 关闭配置弹窗
   - **立即**重新点击"算法配置"按钮
   - **预期结果**：
     - ✅ 预览图片自动加载
     - ✅ 之前绘制的所有区域自动显示
     - ✅ 区域的颜色、名称等属性正确
     - ✅ 线条的方向箭头正确显示
     - ✅ 右侧配置面板显示区域列表
     - ✅ 控制台输出："已加载 N 个配置区域"

4. **重复测试**
   - 多次打开/关闭配置弹窗
   - **预期**：每次打开都能正确显示配置

### ❌ 旧问题表现：
- 关闭再打开，配置区域不显示
- 需要刷新页面或多次开关才能显示

### ✅ 修复后表现：
- 每次打开立即显示所有配置
- 状态清理干净，不会有残留

---

## 🧪 测试场景2：告警详情可视化

### 前置条件：

确保有告警数据：
1. 算法服务已注册
2. 抽帧任务已运行并配置
3. 已产生告警记录

### 步骤：

1. **进入告警列表**
   ```
   侧边栏 → 智能分析告警
   ```

2. **查看告警详情**
   - 选择一条告警记录
   - 点击"查看"按钮

3. **检查可视化效果**
   
   **预期看到**：
   
   #### 🔵 配置区域（虚线）
   - 显示绘制的检测区域（虚线边框）
   - 半透明填充
   - 颜色：配置时设置的颜色或蓝色
   - 线条带箭头（如果是绊线类型）
   - 显示区域名称标签
   
   #### 🟢 检测结果（实线）
   - 显示检测到的目标边界框（实线边框）
   - 不透明
   - 颜色：绿色（高置信度）或橙色（低置信度）
   - 显示类别和置信度标签
   
   #### 📊 图例说明
   - 底部显示："检测目标: X 个"
   - 底部显示："配置区域: Y 个"
   - 图例：虚线=配置区域 ｜ 实线=检测结果

4. **对比验证**
   - 配置区域应该与在抽帧管理中绘制的一致
   - 检测结果应该在配置区域内或附近
   - 两者应该清晰可区分

### ❌ 旧问题表现：
- 只显示检测结果框
- 看不到原始配置区域
- 无法判断检测是否符合预期

### ✅ 修复后表现：
- 同时显示配置和检测结果
- 虚线/实线清晰区分
- 可以直观对比配置和实际检测

---

## 🎨 视觉效果说明

### 配置区域特征
```
┌ ─ ─ ─ ─ ─ ─ ─ ┐    ← 虚线边框
│  半透明填充   │    ← 半透明（opacity: 0.2-0.3）
└ ─ ─ ─ ─ ─ ─ ─ ┘
  区域名称             ← 小号标签
```

### 检测结果特征
```
┏━━━━━━━━━━━┓      ← 实线边框（粗）
┃  不透明  ┃      ← 不透明（只有边框）
┗━━━━━━━━━━━┛
 人员 95.2%          ← 类别+置信度标签
```

### 线条类型（绊线）
```
         ↓         ← 箭头表示方向
  ─ ─ ─ ─ ─ ─ ─   ← 虚线
```

---

## 🐛 常见问题排查

### 问题1：配置不回显

**检查项**：
- [ ] 浏览器控制台是否有错误
- [ ] 预览图片是否加载成功
- [ ] 控制台是否输出："开始加载已有配置..."
- [ ] 是否真的保存了配置（点击保存按钮）

**解决方法**：
1. 打开浏览器开发者工具（F12）
2. 切换到Console标签
3. 重新打开配置弹窗
4. 查看日志输出

**正常日志示例**：
```
Canvas initialized, loading preview image...
Preview image loaded: {original: "1920x1080", canvas: "800x450", scale: 0.417}
开始加载已有配置...
获取到配置: 3 个区域
区域 线_1 坐标转换: ...
绘制区域: 线_1 line [[100, 200], [300, 400]]
已加载 3 个配置区域
```

### 问题2：告警详情看不到配置区域

**检查项**：
- [ ] 该任务是否配置了算法参数
- [ ] 浏览器控制台是否有错误
- [ ] 控制台是否输出："已加载算法配置"

**解决方法**：
1. 先去抽帧管理配置算法参数
2. 刷新告警列表
3. 重新查看告警详情

**正常日志示例**：
```
已加载算法配置: {regions: Array(2), algorithm_params: {...}}
开始绘制所有图层: {hasAlgoConfig: true, detectionsCount: 3}
绘制配置区域: 2 个
绘制检测框: 3 个
所有图层绘制完成
```

### 问题3：图层重叠看不清

**原因**：配置区域和检测结果颜色相似

**解决方法**：
1. 在算法配置中修改区域颜色
2. 使用不同颜色区分不同区域
3. 调整透明度

### 问题4：坐标不准确

**可能原因**：
- 图片分辨率变化
- 坐标系统问题

**解决方法**：
1. 删除旧配置
2. 重新绘制区域
3. 保存配置（使用归一化坐标）

---

## 📊 测试检查清单

### 算法配置回显测试

- [ ] 线条可以正常回显
- [ ] 矩形可以正常回显
- [ ] 多边形可以正常回显
- [ ] 线条方向箭头正确显示
- [ ] 区域颜色正确
- [ ] 区域名称正确
- [ ] 多次打开关闭都能正常显示
- [ ] 控制台无错误

### 告警详情可视化测试

- [ ] 配置区域显示（虚线）
- [ ] 检测结果显示（实线）
- [ ] 线条方向箭头显示
- [ ] 区域名称标签显示
- [ ] 检测类别标签显示
- [ ] 置信度显示正确
- [ ] 图例说明清晰
- [ ] 配置和检测清晰区分
- [ ] 控制台无错误

---

## 🎬 测试演示视频（可选）

建议录制以下场景的操作视频：

1. **场景1录制内容**：
   - 打开算法配置
   - 绘制区域并保存
   - 关闭弹窗
   - 立即重新打开
   - 展示配置正确回显

2. **场景2录制内容**：
   - 打开告警详情
   - 展示配置区域（虚线）和检测结果（实线）
   - 鼠标指向图例说明
   - 对比配置和实际检测

---

## 📝 测试报告模板

```markdown
## 测试环境
- 浏览器：Chrome/Firefox/Safari [版本号]
- 系统版本：[EasyDarwin版本]
- 测试日期：[日期]

## 测试结果

### 场景1：算法配置回显
- 状态：✅ 通过 / ❌ 失败
- 问题：[如有问题请描述]
- 截图：[如有异常请截图]

### 场景2：告警详情可视化
- 状态：✅ 通过 / ❌ 失败
- 问题：[如有问题请描述]
- 截图：[如有异常请截图]

## 其他发现
[其他问题或建议]
```

---

## ✅ 测试完成标准

所有以下项都满足，才算测试通过：

1. ✅ 算法配置可以每次正常回显
2. ✅ 告警详情显示配置区域和检测结果
3. ✅ 配置区域（虚线）和检测结果（实线）清晰区分
4. ✅ 线条方向箭头正确显示
5. ✅ 区域名称和检测标签清晰可读
6. ✅ 浏览器控制台无错误
7. ✅ 多次操作都稳定正常

---

## 🚀 快速命令

```bash
# 编译前端
cd web-src && npm run build && cd ..

# 重启服务
./stop.sh && sleep 2 && ./start.sh

# 查看日志
tail -f logs/sugar.log

# 清除浏览器缓存（重要！）
Ctrl+Shift+Del （或 Cmd+Shift+Del）
选择"缓存的图像和文件"并清除
```

---

**测试指南版本**：v1.0  
**更新日期**：2025-10-22  
**适用版本**：EasyDarwin v2.0+

