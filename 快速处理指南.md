# yanying MinIO 502é—®é¢˜ - æ‚¨åº”è¯¥æ€ä¹ˆå¤„ç†

## ğŸ¯ ç®€å•è¯´æ˜

æ‚¨é‡åˆ°çš„"MinIO 502 Bad Gateway"é”™è¯¯æ˜¯MinIO Go SDKä¸MinIOæœåŠ¡å™¨ä¹‹é—´çš„å…¼å®¹æ€§é—®é¢˜ã€‚

**å¥½æ¶ˆæ¯**ï¼šâœ… æŠ½å¸§åŠŸèƒ½ã€AIæœåŠ¡æ³¨å†Œç­‰æ ¸å¿ƒåŠŸèƒ½éƒ½æ­£å¸¸  
**é—®é¢˜ç‚¹**ï¼šâŒ AIåˆ†ææ‰«æMinIOæ—¶æŠ¥502é”™è¯¯

---

## ğŸš€ æ¨èå¤„ç†æ–¹æ¡ˆï¼ˆæŒ‰ä¼˜å…ˆçº§ï¼‰

### æ–¹æ¡ˆ1ï¼šåˆ‡æ¢åˆ°æœ¬åœ°å­˜å‚¨ï¼ˆæœ€å¿«æœ€ç¨³å®šï¼‰â­

**ä¼˜ç‚¹**ï¼šç«‹å³å¯ç”¨ï¼Œ100%ç¨³å®š  
**ç¼ºç‚¹**ï¼šAIåˆ†æåŠŸèƒ½éœ€è¦æ‰‹åŠ¨å¤„ç†å›¾ç‰‡

```bash
cd /code/EasyDarwin

# ä¸€é”®åˆ‡æ¢
echo "1" | ./å®Œæ•´ä¿®å¤æ–¹æ¡ˆ.sh
```

**æˆ–æ‰‹åŠ¨æ“ä½œ**ï¼š

```bash
# 1. ä¿®æ”¹é…ç½®
cd /code/EasyDarwin/build/EasyDarwin-lin-v8.3.3-202510161428/configs
vi config.toml

# ä¿®æ”¹è¿™ä¸¤å¤„ï¼š
[frame_extractor]
store = 'local'  # æ”¹ä¸ºlocal

[ai_analysis]
enable = false   # æš‚æ—¶ç¦ç”¨

# 2. é‡å¯æœåŠ¡
cd ..
pkill -9 easydarwin
./easydarwin &

# 3. éªŒè¯
sleep 5
tail -f logs/20251016_08_00_00.log | grep "frameextractor started"
# åº”è¯¥çœ‹åˆ°: "store":"local"
```

**ç»“æœ**ï¼š
- âœ… æŠ½å¸§æ­£å¸¸å·¥ä½œï¼Œå›¾ç‰‡ä¿å­˜åˆ° `./snapshots`
- âœ… æ‰€æœ‰æµåª’ä½“åŠŸèƒ½æ­£å¸¸
- âŒ AIè‡ªåŠ¨æ‰«ææš‚ä¸å¯ç”¨ï¼ˆéœ€è¦æ‰‹åŠ¨å¤„ç†å›¾ç‰‡ï¼‰

---

### æ–¹æ¡ˆ2ï¼šç­‰å¾…ä¸‹ä¸€ä¸ªç‰ˆæœ¬ä¿®å¤

MinIO SDKçš„502é—®é¢˜å¯èƒ½éœ€è¦ä»£ç å±‚é¢ä¿®å¤ã€‚

**å»ºè®®**ï¼š
1. æš‚æ—¶ä½¿ç”¨æ–¹æ¡ˆ1ï¼ˆæœ¬åœ°å­˜å‚¨ï¼‰
2. æˆ‘ä»¬ä¼šåœ¨ä»£ç ä¸­æ·»åŠ æ›´å¥½çš„é”™è¯¯å¤„ç†
3. å‡çº§MinIO SDKç‰ˆæœ¬

---

### æ–¹æ¡ˆ3ï¼šä½¿ç”¨æœ¬åœ°MinIOæœåŠ¡

åœ¨æœ¬æœºå¯åŠ¨ä¸€ä¸ªæ–°çš„MinIOå®ä¾‹ï¼ˆæ— éœ€Dockerï¼‰ï¼š

```bash
# 1. ä¸‹è½½MinIO
wget https://dl.min.io/server/minio/release/linux-amd64/minio -O /usr/local/bin/minio
chmod +x /usr/local/bin/minio

# 2. å¯åŠ¨MinIOï¼ˆä½¿ç”¨ä¸åŒçš„ç«¯å£ï¼‰
mkdir -p ~/minio-data
MINIO_ROOT_USER=admin MINIO_ROOT_PASSWORD=admin123 \
  minio server ~/minio-data --address :19000 --console-address :19001 &

# 3. ç­‰å¾…å¯åŠ¨
sleep 5

# 4. é…ç½®bucket
/tmp/mc alias set local http://localhost:19000 admin admin123
/tmp/mc mb local/images
/tmp/mc anonymous set download local/images

# 5. ä¿®æ”¹yanyingé…ç½®
vi /code/EasyDarwin/build/EasyDarwin-lin-v8.3.3-202510161428/configs/config.toml
# ä¿®æ”¹endpointä¸º: endpoint = 'localhost:19000'

# 6. é‡å¯yanying
cd /code/EasyDarwin/build/EasyDarwin-lin-v8.3.3-202510161428
pkill -9 easydarwin
./easydarwin &
```

---

## ğŸ“Š å½“å‰çŠ¶æ€åˆ†æ

ä»æœ€æ–°æ—¥å¿—çœ‹ï¼š

| åŠŸèƒ½ | çŠ¶æ€ | è¯æ® |
|------|------|------|
| yanyingä¸»æœåŠ¡ | âœ… è¿è¡Œ | è¿›ç¨‹å­˜åœ¨ |
| æŠ½å¸§æ’ä»¶ | âœ… å¯ç”¨ | store=minio |
| MinIO bucketæƒé™ | âœ… å·²è®¾ç½® | downloadæƒé™ |
| MinIOå›¾ç‰‡å­˜å‚¨ | âœ… æ­£å¸¸ | å·²æœ‰å¤§é‡å›¾ç‰‡ |
| AIæœåŠ¡æ³¨å†Œ | âœ… æ­£å¸¸ | 4ä¸ªæœåŠ¡ |
| AIæ‰«æMinIO | âŒ 502é”™è¯¯ | **æ ¸å¿ƒé—®é¢˜** |

**æ ¸å¿ƒé—®é¢˜**ï¼šGo MinIO SDKçš„`ListObjects`è°ƒç”¨è¿”å›502

---

## ğŸ’¡ æˆ‘çš„å»ºè®®

### ç«‹å³æ‰§è¡Œï¼ˆä»Šå¤©ï¼‰

**ä½¿ç”¨æ–¹æ¡ˆ1 - åˆ‡æ¢åˆ°æœ¬åœ°å­˜å‚¨**

```bash
cd /code/EasyDarwin/build/EasyDarwin-lin-v8.3.3-202510161428/configs

# ä¿®æ”¹é…ç½®
sed -i "s/store = 'minio'/store = 'local'/" config.toml
sed -i '/\[ai_analysis\]/,/^max_concurrent/s/enable = true/enable = false/' config.toml

# é‡å¯
cd ..
pkill -9 easydarwin
./easydarwin &
```

**è¿™æ ·æ‚¨å¯ä»¥ç«‹å³ä½¿ç”¨ï¼š**
- âœ… è§†é¢‘æŠ½å¸§ï¼ˆæ¯ç§’1å¸§ï¼‰
- âœ… å›¾ç‰‡ä¿å­˜åˆ°æœ¬åœ°
- âœ… Webç•Œé¢æŸ¥çœ‹
- âœ… æµåª’ä½“æ‰€æœ‰åŠŸèƒ½

---

### åç»­å¤„ç†ï¼ˆæœ¬å‘¨å†…ï¼‰

1. **æIssueåˆ°GitHub**
   - æè¿°502é—®é¢˜
   - é™„ä¸ŠMinIOç‰ˆæœ¬ï¼š2025-09-07T16:13:09Z
   - é™„ä¸Šæ—¥å¿—æ–‡ä»¶

2. **ç­‰å¾…ä»£ç ä¿®å¤**
   - å‡çº§MinIO Go SDK
   - æ·»åŠ æ›´å¥½çš„é”™è¯¯å¤„ç†
   - æä¾›è¡¥ä¸

3. **æˆ–è€…å°è¯•æ–¹æ¡ˆ3**
   - åœ¨æœ¬åœ°å¯åŠ¨MinIO
   - ä½¿ç”¨localhost:19000
   - å¯èƒ½é¿å…ç½‘ç»œé—®é¢˜

---

## ğŸ” 502é”™è¯¯çš„æŠ€æœ¯åˆ†æ

ä»ä»£ç åˆ†æçœ‹ï¼š

```go
// internal/plugin/aianalysis/scanner.go:90
objectCh := s.minio.ListObjects(ctx, s.bucket, minio.ListObjectsOptions{
    Prefix:    s.basePath,
    Recursive: true,
})

for object := range objectCh {
    if object.Err != nil {
        s.log.Warn("list object error", slog.String("err", object.Err.Error()))
        // è¿™é‡ŒæŠ¥502
    }
}
```

**å¯èƒ½åŸå› **ï¼š
1. MinIO Go SDK v7.0.95ä¸æ‚¨çš„MinIOæœåŠ¡å™¨ç‰ˆæœ¬ä¸å…¼å®¹
2. ç½‘ç»œå±‚é¢æœ‰ä»£ç†æˆ–é˜²ç«å¢™å¹²æ‰°
3. MinIOæœåŠ¡å™¨é…ç½®äº†ç‰¹æ®Šçš„ç½‘å…³æ¨¡å¼

**curlå¯ä»¥å·¥ä½œä½†Go SDKä¸è¡Œ**è¯´æ˜æ˜¯SDKå±‚é¢çš„é—®é¢˜ã€‚

---

## ğŸ“ éœ€è¦å¸®åŠ©ï¼Ÿ

è¿è¡Œè¯Šæ–­è„šæœ¬ï¼š
```bash
cd /code/EasyDarwin
./debug_minio_502.sh
```

æŸ¥çœ‹å®Œæ•´æ–‡æ¡£ï¼š
```bash
cat MINIO_TROUBLESHOOTING.md
```

---

## âœ… æœ€ç»ˆå»ºè®®

**å¦‚æœæ‚¨ç°åœ¨éœ€è¦ä½¿ç”¨ç³»ç»Ÿï¼š**
â†’ ä½¿ç”¨æ–¹æ¡ˆ1ï¼ˆæœ¬åœ°å­˜å‚¨ï¼‰ï¼Œç«‹å³å¯ç”¨

**å¦‚æœæ‚¨æœ‰æ—¶é—´æ’æŸ¥ï¼š**
â†’ æIssueåˆ°GitHubï¼Œé™„ä¸Šè¯¦ç»†ä¿¡æ¯

**å¦‚æœæ‚¨éœ€è¦MinIOåŠŸèƒ½ï¼š**
â†’ ä½¿ç”¨æ–¹æ¡ˆ3ï¼ˆæœ¬åœ°MinIOå®ä¾‹ï¼‰

---

<div align="center">

## å¿«é€Ÿå†³ç­–

**éœ€è¦ç«‹å³ä½¿ç”¨ï¼Ÿ** â†’ æ–¹æ¡ˆ1ï¼šåˆ‡æ¢æœ¬åœ°å­˜å‚¨  
**æœ‰æ—¶é—´è°ƒè¯•ï¼Ÿ** â†’ æ–¹æ¡ˆ3ï¼šæœ¬åœ°MinIO  
**ç­‰å¾…ä¿®å¤ï¼Ÿ** â†’ æGitHub Issue

**ä¸€è¡Œå‘½ä»¤å¿«é€Ÿä¿®å¤ï¼ˆæœ¬åœ°å­˜å‚¨ï¼‰**ï¼š
```bash
cd /code/EasyDarwin/build/EasyDarwin-lin-v8.3.3-202510161428/configs && sed -i "s/store = 'minio'/store = 'local'/" config.toml && cd .. && pkill -9 easydarwin && ./easydarwin &
```

</div>

