import{b as de}from"./vue-router-CQqAHyKR.1760515367000.js";import"./request-C7nI1xs8.1760515367000.js";import{f as T}from"./frameextractor-Jc6XBLAu.1760515367000.js";import{_ as _e}from"./_plugin-vue_export-helper-DlAUqK2U.1760515367000.js";import{m as me,r as pe,k as C,V as ve,X as fe,S as ge,h as ke,B as ye,a4 as he,a5 as Ce,a0 as we,K as Se,a1 as be,c as xe,t as ze,s as Oe,Y as Be,Z as Te}from"./ant-design-vue-DqFxAs7n.1760515367000.js";import{r as v,f as Ve,w as De,j as Fe,Z as g,c as t,V as k,a1 as w,X as l,a9 as Ne,W as u,F as V,_ as Z,J as i,u as r,a3 as _,$ as c,a0 as Ae}from"./vue-DcFgi5qX.1760515367000.js";import{ak as Ie,N as Me,aj as Ue,j as K,al as $e,F as Ke,A as D,am as je,an as Ee,ao as Le,G as Re}from"./@ant-design-COZWVxtt.1760515367000.js";import"./axios-ngrFHoWO.1760515367000.js";import"./qs-Cl2lQjMd.1760515367000.js";import"./clipboard-DnI0MzOy.1760515367000.js";import"./side-channel-DgASepVR.1760515367000.js";import"./crypto-js-OB0QhLL9.1760515367000.js";import"./index-B2QADIIA.1760515367000.js";import"./vue-i18n-CZb58ogJ.1760515367000.js";import"./@intlify-C7-MzqOv.1760515367000.js";import"./nprogress-ZEQ_r78A.1760515367000.js";/* empty css                                  */import"./dayjs-BacLl1bS.1760515367000.js";import"./pinia-Bs9O-4WV.1760515367000.js";import"./pinia-plugin-persistedstate-n2tMOXAx.1760515367000.js";import"./lodash-es-C9rdhAyu.1760515367000.js";import"./@iconify-zSLhKG-E.1760515367000.js";import"./@babel-Bq4_u9L9.1760515367000.js";import"./@ctrl-DOFZgDuz.1760515367000.js";import"./resize-observer-polyfill-B1PUzC5B.1760515367000.js";import"./dom-align-CRCehRfe.1760515367000.js";import"./async-validator-9PlIezaS.1760515367000.js";import"./scroll-into-view-if-needed-B3z4cY-J.1760515367000.js";import"./throttle-debounce-CUWDS_la.1760515367000.js";import"./vue-types-CF28atMM.1760515367000.js";import"./@emotion-BtrR-yrm.1760515367000.js";import"./stylis-D5iaQeiq.1760515367000.js";const qe={class:"p-4 gallery-container"},Pe={class:"card-title"},Xe={class:"card-title"},Ze={key:0},Ge={class:"batch-actions mb-4"},Je={key:0,class:"ml-2 text-muted"},We={class:"image-grid"},Ye={class:"checkbox-overlay"},He=["onClick"],Qe=["src","alt"],et={class:"image-overlay"},tt={class:"image-info"},lt=["title"],at={class:"meta"},ot={class:"actions"},nt=["src","onClick"],st={class:"preview-content"},it=["src"],ut={__name:"gallery",setup(rt){const G=de(),S=v([]),m=v(null),d=v([]),b=v(!1),F=v(!1),N=v("grid"),x=v(!1),z=v(null),s=v([]),y=v(!1),J=[{title:"预览",key:"preview",width:100},{title:"文件名",key:"filename"},{title:"大小",key:"size",width:100},{title:"时间",key:"mod_time",width:180},{title:"操作",key:"action",width:150,fixed:"right"}],W=Ve(()=>d.value.reduce((e,n)=>e+n.size,0)/(1024*1024)),Y=async()=>{try{const{data:a}=await T.listTasks();S.value=(a==null?void 0:a.items)||[];const e=G.query.task;e&&S.value.find(n=>n.id===e)?(m.value=e,h()):S.value.length>0&&!m.value&&(m.value=S.value[0].id,h())}catch(a){console.error("fetch tasks failed",a)}},H=()=>{s.value=[],y.value=!1,h()},h=async()=>{var a,e;if(m.value){b.value=!0;try{const{data:n}=await T.listSnapshots(m.value);d.value=(n==null?void 0:n.items)||[],s.value=[],y.value=!1}catch(n){C.error(((e=(a=n==null?void 0:n.response)==null?void 0:a.data)==null?void 0:e.error)||"获取快照列表失败")}finally{b.value=!1}}},Q=a=>{a.target.checked?s.value=d.value.map(e=>e.path):s.value=[]},ee=(a,e)=>{e?s.value.push(a):s.value=s.value.filter(n=>n!==a)},te=a=>{s.value=a};De(()=>s.value.length,a=>{y.value=a>0&&a===d.value.length});const B=a=>{z.value=a,x.value=!0},A=async a=>{var e,n;try{await T.deleteSnapshot(a.task_id,a.path),C.success("删除成功"),await h()}catch(O){C.error(((n=(e=O==null?void 0:O.response)==null?void 0:e.data)==null?void 0:n.error)||"删除失败")}},le=async()=>{var a,e;if(s.value.length===0){C.warning("请先选择要删除的快照");return}F.value=!0;try{await T.batchDeleteSnapshots(m.value,s.value),C.success(`成功删除 ${s.value.length} 个快照`),s.value=[],y.value=!1,await h()}catch(n){C.error(((e=(a=n==null?void 0:n.response)==null?void 0:a.data)==null?void 0:e.error)||"批量删除失败")}finally{F.value=!1}},ae=a=>{if(!a)return;const e=document.createElement("a");e.href=a.url,e.download=a.filename,e.click()},j=a=>a?new Date(a).toLocaleString("zh-CN"):"-",E=a=>a<1024?a+" B":a<1024*1024?(a/1024).toFixed(2)+" KB":(a/(1024*1024)).toFixed(2)+" MB";return Fe(Y),(a,e)=>{var X;const n=ke,O=ge,I=fe,f=ye,L=ve,M=he,oe=Ne("a-statistic-group"),R=me,q=Te,ne=Be,U=ze,P=we,$=Se,se=xe,ie=be,ue=Ce,re=Oe,ce=pe;return u(),g("div",qe,[t(R,{bordered:!1,class:"mb-4"},{title:l(()=>[c("span",Pe,[t(r(Ue),{class:"title-icon"}),e[7]||(e[7]=i(" 抽帧结果查看 ",-1))])]),default:l(()=>[t(L,{gutter:16},{default:l(()=>[t(I,{xs:24,sm:16,md:12},{default:l(()=>[t(O,{value:m.value,"onUpdate:value":e[0]||(e[0]=o=>m.value=o),size:"large",placeholder:"选择任务查看快照",style:{width:"100%"},onChange:H},{default:l(()=>[(u(!0),g(V,null,Z(S.value,o=>(u(),k(n,{key:o.id,value:o.id},{default:l(()=>[t(r(Ie)),i(" "+_(o.id)+" - "+_(o.rtsp_url),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),t(I,{xs:24,sm:8,md:6},{default:l(()=>[t(f,{size:"large",onClick:h,loading:b.value},{icon:l(()=>[t(r(Me))]),default:l(()=>[e[8]||(e[8]=i(" 刷新 ",-1))]),_:1},8,["loading"])]),_:1})]),_:1}),m.value?(u(),k(L,{key:0,class:"mt-4"},{default:l(()=>[t(I,{span:24},{default:l(()=>[t(oe,null,{default:l(()=>[t(M,{title:"总快照数",value:d.value.length},null,8,["value"]),t(M,{title:"总大小",value:W.value,suffix:"MB",precision:2},null,8,["value"]),t(M,{title:"最新快照",value:d.value.length>0?d.value[0].filename:"-"},null,8,["value"])]),_:1})]),_:1})]),_:1})):w("",!0)]),_:1}),m.value?(u(),k(R,{key:0,bordered:!1},{title:l(()=>[c("span",Xe,[t(r(Le),{class:"title-icon"}),i(" 快照列表 ("+_(d.value.length)+") ",1)])]),extra:l(()=>[t(U,null,{default:l(()=>[s.value.length>0?(u(),k(f,{key:0,danger:"",onClick:le,loading:F.value},{icon:l(()=>[t(r(D))]),default:l(()=>[i(" 删除选中 ("+_(s.value.length)+") ",1)]),_:1},8,["loading"])):w("",!0),t(ne,{value:N.value,"onUpdate:value":e[1]||(e[1]=o=>N.value=o),"button-style":"solid",size:"large"},{default:l(()=>[t(q,{value:"grid"},{default:l(()=>[t(r(je)),e[9]||(e[9]=i(" 网格 ",-1))]),_:1}),t(q,{value:"list"},{default:l(()=>[t(r(Ee)),e[10]||(e[10]=i(" 列表 ",-1))]),_:1})]),_:1},8,["value"])]),_:1})]),default:l(()=>[t(ue,{spinning:b.value},{default:l(()=>[N.value==="grid"?(u(),g("div",Ze,[c("div",Ge,[t(P,{checked:y.value,"onUpdate:checked":e[2]||(e[2]=o=>y.value=o),onChange:Q},{default:l(()=>[...e[11]||(e[11]=[i(" 全选 ",-1)])]),_:1},8,["checked"]),s.value.length>0?(u(),g("span",Je," 已选 "+_(s.value.length)+" 项 ",1)):w("",!0)]),c("div",We,[(u(!0),g(V,null,Z(d.value,o=>(u(),g("div",{key:o.path,class:Ae(["image-card",{selected:s.value.includes(o.path)}])},[c("div",Ye,[t(P,{checked:s.value.includes(o.path),onChange:p=>ee(o.path,p.target.checked)},null,8,["checked","onChange"])]),c("div",{class:"image-wrapper",onClick:()=>B(o)},[c("img",{src:o.url,alt:o.filename,loading:"lazy"},null,8,Qe),c("div",et,[t(r(K),{class:"preview-icon"})])],8,He),c("div",tt,[c("div",{class:"filename",title:o.filename},_(o.filename),9,lt),c("div",at,[c("span",null,[t(r($e)),i(" "+_(j(o.mod_time)),1)]),c("span",null,[t(r(Ke)),i(" "+_(E(o.size)),1)])]),c("div",ot,[t(f,{type:"primary",size:"small",onClick:()=>B(o)},{icon:l(()=>[t(r(K))]),default:l(()=>[e[12]||(e[12]=i(" 预览 ",-1))]),_:1},8,["onClick"]),t($,{title:"确认删除?",onConfirm:()=>A(o)},{default:l(()=>[t(f,{danger:"",size:"small"},{icon:l(()=>[t(r(D))]),default:l(()=>[e[13]||(e[13]=i(" 删除 ",-1))]),_:1})]),_:1},8,["onConfirm"])])])],2))),128))])])):(u(),k(ie,{key:1,"data-source":d.value,columns:J,"row-selection":{selectedRowKeys:s.value,onChange:te},"row-key":"path",pagination:{pageSize:20,showTotal:o=>`共 ${o} 条`}},{bodyCell:l(({column:o,record:p})=>[o.key==="preview"?(u(),g("img",{key:0,src:p.url,class:"thumbnail",onClick:()=>B(p)},null,8,nt)):o.key==="filename"?(u(),k(se,{key:1,title:p.path},{default:l(()=>[i(_(p.filename),1)]),_:2},1032,["title"])):o.key==="size"?(u(),g(V,{key:2},[i(_(E(p.size)),1)],64)):o.key==="mod_time"?(u(),g(V,{key:3},[i(_(j(p.mod_time)),1)],64)):o.key==="action"?(u(),k(U,{key:4},{default:l(()=>[t(f,{type:"link",onClick:()=>B(p)},{icon:l(()=>[t(r(K))]),default:l(()=>[e[14]||(e[14]=i(" 预览 ",-1))]),_:1},8,["onClick"]),t($,{title:"确认删除?",onConfirm:()=>A(p)},{default:l(()=>[t(f,{type:"link",danger:""},{icon:l(()=>[t(r(D))]),default:l(()=>[e[15]||(e[15]=i(" 删除 ",-1))]),_:1})]),_:1},8,["onConfirm"])]),_:2},1024)):w("",!0)]),_:1},8,["data-source","row-selection","pagination"]))]),_:1},8,["spinning"]),!b.value&&d.value.length===0?(u(),k(re,{key:0,description:"暂无快照数据"})):w("",!0)]),_:1})):w("",!0),t(ce,{open:x.value,"onUpdate:open":e[6]||(e[6]=o=>x.value=o),footer:null,width:"80%",title:(X=z.value)==null?void 0:X.filename,centered:""},{footer:l(()=>[t(U,null,{default:l(()=>[t(f,{onClick:e[3]||(e[3]=o=>x.value=!1)},{default:l(()=>[...e[16]||(e[16]=[i("关闭",-1)])]),_:1}),t(f,{type:"primary",onClick:e[4]||(e[4]=o=>ae(z.value))},{icon:l(()=>[t(r(Re))]),default:l(()=>[e[17]||(e[17]=i(" 下载 ",-1))]),_:1}),t($,{title:"确认删除?",onConfirm:e[5]||(e[5]=()=>{A(z.value),x.value=!1})},{default:l(()=>[t(f,{danger:""},{icon:l(()=>[t(r(D))]),default:l(()=>[e[18]||(e[18]=i(" 删除 ",-1))]),_:1})]),_:1})]),_:1})]),default:l(()=>{var o;return[c("div",st,[c("img",{src:(o=z.value)==null?void 0:o.url,style:{width:"100%"}},null,8,it)])]}),_:1},8,["open","title"])])}}},Lt=_e(ut,[["__scopeId","data-v-6e9eb03a"]]);export{Lt as default};
